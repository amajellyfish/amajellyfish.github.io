<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="false"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title>Managing Packages, Repositories, and Subscriptions with Ansible &middot; David Thomas</title>
    <meta name="title" content="Managing Packages, Repositories, and Subscriptions with Ansible &middot; David Thomas">
  

  
  
    <meta name="description" content="How to Manage Packages, Repositories, and Subscriptions with Ansible">
  
  
  
  
  <link rel="canonical" href="http://localhost:1313/tech-notes/rhce/managing-packages-repositories-and-subscriptions-with-ansible/">
  

  
  
    <meta name="author" content="David Thomas">
  
  

  
  <meta property="og:url" content="http://localhost:1313/tech-notes/rhce/managing-packages-repositories-and-subscriptions-with-ansible/">
  <meta property="og:site_name" content="David Thomas">
  <meta property="og:title" content="Managing Packages, Repositories, and Subscriptions with Ansible">
  <meta property="og:description" content="How to Manage Packages, Repositories, and Subscriptions with Ansible">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tech-notes">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Managing Packages, Repositories, and Subscriptions with Ansible">
  <meta name="twitter:description" content="How to Manage Packages, Repositories, and Subscriptions with Ansible">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
  
  
  
  

  

  
  
  
  
  
  
  
    
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.c5c4ab59b36e3a06d6dff38478af5d2c18b2d7a3603611d7fc5647b02111f989bd5957610b6bed4d10718428186bc7c38590e84c77c0d50f401da78f4fbb5384.css"
    integrity="sha512-xcSrWbNuOgbW3/OEeK9dLBiy16NgNhHX/FZHsCER&#43;Ym9WVdhC2vtTRBxhCgYa8fDhZDoTHfA1Q9AHaePT7tThA==">

  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
  
    
    <script src="/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js" integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7&#43;kfJ6kKCJxQGC&#43;8wm&#43;Bz9JucDjDTGNew=="></script>
  

  
  
  
    
  
  
    
  
  
    
  
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js"
      integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP&#43;pSqMXxm6JPOUeAg=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>


























  

  

  

  

  





  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "",
    "name": "Managing Packages, Repositories, and Subscriptions with Ansible",
    "headline": "Managing Packages, Repositories, and Subscriptions with Ansible",
    "description": "How to Manage Packages, Repositories, and Subscriptions with Ansible",
    "abstract": "\u003ch2 class=\u0022relative group\u0022\u003eUsing Modules to Manage Packages\n    \u003cdiv id=\u0022using-modules-to-manage-packages\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#using-modules-to-manage-packages\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h2\u003e\n\u003cp\u003eModules used to manage packages:\n\u003cfigure\u003e\u003cimg\n    class=\u0022my-0 rounded-md\u0022\n    loading=\u0022lazy\u0022\n    decoding=\u0022async\u0022\n    fetchpriority=\u0022low\u0022\n    alt=\u0022Image\u0022\n    src=\u0022..\/..\/..\/img\/12tab02.jpg\u0022\n    \u003e\u003c\/figure\u003e\n\u003c\/p\u003e\n\n\u003ch4 class=\u0022relative group\u0022\u003eConfiguring Repository Access\n    \u003cdiv id=\u0022configuring-repository-access\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#configuring-repository-access\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h4\u003e\n\u003cp\u003eThe \u003cstrong\u003eyum_repository\u003c\/strong\u003e module lets you work with yum repository files in the \/etc\/yum.repos.d\/ directory.\u003c\/p\u003e",
    "inLanguage": "en",
    "url" : "http://localhost:1313/tech-notes/rhce/managing-packages-repositories-and-subscriptions-with-ansible/",
    "author" : {
      "@type": "Person",
      "name": "David Thomas"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "2832"
  }]
  </script>



  
  

  
  

  
  

  
  
    
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
      <script>

    const firebaseConfig = {
      apiKey: "AIzaSyApsKLCbGb5fkkrzxABOtl3-OUuBcRPVsc",
      authDomain: "davidwrites-89dd7.firebaseapp.com",
      projectId: "davidwrites-89dd7",
      storageBucket: "davidwrites-89dd7.firebasestorage.app",
      messagingSenderId: "433139099634",
      appId: "1:433139099634:web:c14275555bd7171e6c6d6b",
      measurementId: "G-XX5507B82W"
    };

        var app = firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();
        var auth = firebase.auth();

      </script>
    
  

  
  
</head>







  
    
  







  
    
  






  
  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      













<div
  class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0">
  
  
    
    

  <div class="flex flex-1 items-center justify-between">
    <nav class="flex space-x-3">
      
        <a href="/" class="text-base font-medium">
          David Thomas
        </a>
      
    </nav>
    
  <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">
    
      
        
  <a
  href="/tech-notes/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Tech Notes"
  title="">
  
  
    <p class="text-base font-medium">
      Tech Notes
    </p>
  
</a>



      
        
  <a
  href="/notes/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Notes"
  title="Book Notes &amp; Reviews">
  
  
    <p class="text-base font-medium">
      Notes
    </p>
  
</a>



      
        
  <a
  href="/articles/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Articles"
  title="Articles">
  
  
    <p class="text-base font-medium">
      Articles
    </p>
  
</a>



      
        
  <a
  href="/now/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Now"
  title="Now">
  
  
    <p class="text-base font-medium">
      Now
    </p>
  
</a>



      
        
  <a
  href=""
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  
  title="">
  
  
</a>



      
    

    

    

    
      <button
        id="search-button"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
  </nav>

    
  <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">
    <span></span>

    

    

    
      <button
        id="search-button-mobile"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
  </div>

  </div>
  
  <div class="-my-2 md:hidden">
    <div id="menu-button" class="block">
      
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]">
          <ul
            class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl">
            <li id="menu-close-button">
              <span
                class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">
                <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
              </span>
            </li>

            
              
  <li class="mt-1">
  <a
    href="/tech-notes/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Tech Notes"
    title="">
    
    
      <p class="text-bg font-bg">
        Tech Notes
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/notes/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Notes"
    title="Book Notes &amp; Reviews">
    
    
      <p class="text-bg font-bg">
        Notes
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/articles/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Articles"
    title="Articles">
    
    
      <p class="text-bg font-bg">
        Articles
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/now/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Now"
    title="Now">
    
    
      <p class="text-bg font-bg">
        Now
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href=""
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    
    title="">
    
    
  </a>
</li>



            

          </ul>
          
        </div>
      
    </div>
  </div>

</div>




  <script>
    (function () {
      var $mainmenu = $(".main-menu");
      var path = window.location.pathname;
      $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
        $(e).children("p").addClass("active");
      });
    })();
  </script>


    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Managing Packages, Repositories, and Subscriptions with Ansible
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  
    
  

  

  

  

  
    
  

  
    
  

  
    
  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="0001-01-01T00:00:00&#43;00:00">1 January 0001</time><span class="px-2 text-primary-500">&middot;</span><span>
  
  
    
    
      
      
        
        
      
      
    
  
  <span
    id="views_tech notes/RHCE/Managing Packages Repositories and Subscriptions with Ansible.md"
    class="animate-pulse inline-block text-transparent max-h-3 rounded-full -mt-[2px] align-middle bg-neutral-300 dark:bg-neutral-400"
    title="views"
    >loading</span
  >
  <span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
<path fill="currentColor" d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span>
</span>
<span class="px-2 text-primary-500">&middot;</span><span>
  
  
    
    
      
      
        
        
      
      
    
  
  <span
    id="likes_tech notes/RHCE/Managing Packages Repositories and Subscriptions with Ansible.md"
    class="animate-pulse inline-block text-transparent max-h-3 rounded-full -mt-[2px] align-middle bg-neutral-300 dark:bg-neutral-400"
    title="likes"
    >loading</span
  >
  <span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span></span>
</span>
<span class="px-2 text-primary-500">&middot;</span><span>
  <button
    id="button_likes"
    class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    <span id="button_likes_heart" class="inline-block align-text-bottom hidden"
      ><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span>
    </span>
    <span id="button_likes_emtpty_heart" class="inline-block align-text-bottom"
      ><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M244 84L255.1 96L267.1 84.02C300.6 51.37 347 36.51 392.6 44.1C461.5 55.58 512 115.2 512 185.1V190.9C512 232.4 494.8 272.1 464.4 300.4L283.7 469.1C276.2 476.1 266.3 480 256 480C245.7 480 235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1 0 232.4 0 190.9V185.1C0 115.2 50.52 55.58 119.4 44.1C164.1 36.51 211.4 51.37 244 84C243.1 84 244 84.01 244 84L244 84zM255.1 163.9L210.1 117.1C188.4 96.28 157.6 86.4 127.3 91.44C81.55 99.07 48 138.7 48 185.1V190.9C48 219.1 59.71 246.1 80.34 265.3L256 429.3L431.7 265.3C452.3 246.1 464 219.1 464 190.9V185.1C464 138.7 430.4 99.07 384.7 91.44C354.4 86.4 323.6 96.28 301.9 117.1L255.1 163.9z"/></svg></span></span
    >
    <span id="button_likes_text">&nbsp;Like</span>
  </button>
</span>
    

    
    
  </div>

  

  
  

  
  



      </div>
      
        
  
  
  
  
  
  

  

  

  

  

      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      
        <div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
          <div class="toc ps-5 print:hidden lg:sticky lg:top-10">
            
              <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#using-modules-to-manage-packages">Using Modules to Manage Packages</a>
      <ul>
        <li>
          <ul>
            <li><a href="#configuring-repository-access">Configuring Repository Access</a></li>
            <li><a href="#managing-software-with-yum">Managing Software with yum</a></li>
            <li><a href="#managing-package-facts">Managing Package Facts</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#using-modules-to-manage-repositories-and-subscriptions">Using Modules to Manage Repositories and Subscriptions</a>
      <ul>
        <li>
          <ul>
            <li><a href="#setting-up-repositories">Setting Up Repositories</a></li>
            <li><a href="#managing-gpg-keys">Managing GPG Keys</a></li>
            <li><a href="#managing-rhel-subscriptions">Managing RHEL Subscriptions</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#using-modules-to-manage-packages">Using Modules to Manage Packages</a>
      <ul>
        <li>
          <ul>
            <li><a href="#configuring-repository-access">Configuring Repository Access</a></li>
            <li><a href="#managing-software-with-yum">Managing Software with yum</a></li>
            <li><a href="#managing-package-facts">Managing Package Facts</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#using-modules-to-manage-repositories-and-subscriptions">Using Modules to Manage Repositories and Subscriptions</a>
      <ul>
        <li>
          <ul>
            <li><a href="#setting-up-repositories">Setting Up Repositories</a></li>
            <li><a href="#managing-gpg-keys">Managing GPG Keys</a></li>
            <li><a href="#managing-rhel-subscriptions">Managing RHEL Subscriptions</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>


<script>
  (function () {
    'use strict'

    const SCROLL_OFFSET_RATIO = 0.33
    const TOC_SELECTOR = '#TableOfContents'
    const ANCHOR_SELECTOR = '.anchor'
    const TOC_LINK_SELECTOR = 'a[href^="#"]'
    const NESTED_LIST_SELECTOR = 'li ul'
    const ACTIVE_CLASS = 'active'
    let isJumpingToAnchor = false

    function getActiveAnchorId(anchors, offsetRatio) {
      const threshold = window.scrollY + window.innerHeight * offsetRatio
      const tocLinks = [...document.querySelectorAll('#TableOfContents a[href^="#"]')]
      const tocIds = new Set(tocLinks.map(link => link.getAttribute('href').substring(1)))

      if (isJumpingToAnchor) {
        for (let i = 0; i < anchors.length; i++) {
          const anchor = anchors[i]
          if (!tocIds.has(anchor.id)) continue
          const top = anchor.getBoundingClientRect().top + window.scrollY
          if (Math.abs(window.scrollY - top) < 100) {
            return anchor.id
          }
        }
      }

      for (let i = anchors.length - 1; i >= 0; i--) {
        const top = anchors[i].getBoundingClientRect().top + window.scrollY
        if (top <= threshold && tocIds.has(anchors[i].id)) {
          return anchors[i].id
        }
      }
      return anchors.find(anchor => tocIds.has(anchor.id))?.id || ''
    }

    function updateTOC({ toc, anchors, links, scrollOffset, collapseInactive }) {
      const activeId = getActiveAnchorId(anchors, scrollOffset)
      if (!activeId) return

      links.forEach(link => {
        const isActive = link.getAttribute('href') === `#${activeId}`
        link.classList.toggle(ACTIVE_CLASS, isActive)

        if (collapseInactive) {
          const ul = link.closest('li')?.querySelector('ul')
          if (ul) ul.style.display = isActive ? '' : 'none'
        }
      })

      if (collapseInactive) {
        const activeLink = toc.querySelector(`a[href="#${CSS.escape(activeId)}"]`)
        let el = activeLink
        while (el && el !== toc) {
          if (el.tagName === 'UL') el.style.display = ''
          if (el.tagName === 'LI') el.querySelector('ul')?.style.setProperty('display', '')
          el = el.parentElement
        }
      }
    }

    function initTOC() {
      const toc = document.querySelector(TOC_SELECTOR)
      if (!toc) return

      const collapseInactive = true
      const anchors = [...document.querySelectorAll(ANCHOR_SELECTOR)]
      const links = [...toc.querySelectorAll(TOC_LINK_SELECTOR)]

      if (collapseInactive) {
        toc.querySelectorAll(NESTED_LIST_SELECTOR).forEach(ul => ul.style.display = 'none')
      }

      links.forEach(link => {
        link.addEventListener('click', () => {
          isJumpingToAnchor = true
        })
      })

      const config = {
        toc,
        anchors,
        links,
        scrollOffset: SCROLL_OFFSET_RATIO,
        collapseInactive
      }

      window.addEventListener('scroll', () => updateTOC(config), { passive: true })
      window.addEventListener('hashchange', () => updateTOC(config), { passive: true })

      updateTOC(config)
    }

    document.readyState === 'loading'
      ? document.addEventListener('DOMContentLoaded', initTOC)
      : initTOC()
  })()
</script>


            
          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        

        <div class="article-content max-w-prose mb-20">
          
<h2 class="relative group">Using Modules to Manage Packages
    <div id="using-modules-to-manage-packages" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#using-modules-to-manage-packages" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Modules used to manage packages:
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Image"
    src="../../../img/12tab02.jpg"
    ></figure>
</p>

<h4 class="relative group">Configuring Repository Access
    <div id="configuring-repository-access" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#configuring-repository-access" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>The <strong>yum_repository</strong> module lets you work with yum repository files in the /etc/yum.repos.d/ directory.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">    </span>---<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">setting up repository access</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">tasks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">connect to example repo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">yum_repository</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example repo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">RHCE8 example repo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l">examplerepo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">baseurl</span><span class="p">:</span><span class="w"> </span><span class="l">ftp://control.example.com/repo/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">gpgcheck</span><span class="p">:</span><span class="w"> </span><span class="kc">no</span><span class="w">
</span></span></span></code></pre></div><p>yum_repository Key Arguments</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Image"
    src="../../../img/12tab03.jpg"
    ></figure>
<p>Use of the <strong>gpgcheck</strong> argument is recommended but not mandatory.
Most repositories are provided with a GPG key to verify that packages in the repository have not been tampered with. However, if no
GPG key is set up for the repository, the <strong>gpgcheck</strong> parameter can be set to no to skip checking the GPG key.</p>

<h4 class="relative group">Managing Software with yum
    <div id="managing-software-with-yum" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#managing-software-with-yum" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>The yum module can be used to manage software packages. You use it to
install and remove packages or to update packages. This can be done for
individual packages, as well as package groups and modules. Let&rsquo;s look
at some examples that go beyond the mere installation or removal of
packages, which was covered sufficiently in earlier chapters.</p>
<p><a
  href="#ch12.xhtml#list12_2">Listing 12-2</a> shows a module that will update all
packages on this system.</p>
<p><strong>Listing 12-2</strong> Using yum to Perform a System Update</p>
<p>::: pre_1
&mdash;
- name: updating all packages
hosts: ansible2
tasks:
- name: system update
yum:
name: ’*’
state: latest
:::</p>
<p>Notice the use of the <strong>name</strong> argument to the yum module. It has
<strong>&rsquo;*&rsquo;</strong> as its argument. To prevent the wildcard from being interpreted
by the shell, you must make sure it is placed between single quotes.</p>
<p><a
  href="#ch12.xhtml#list12_3">Listing 12-3</a> shows an example where yum package
groups are used to install the Virtualization Host package group.</p>
<p><strong>Listing 12-3</strong> Installing Package Groups</p>
<p>::: pre_1
&mdash;
- name: install or update a package group
hosts: ansible2
tasks:
- name: install or update a package group
yum:
name: ’@Virtualization Host’
state: latest
:::</p>
<p>When a yum package group instead of an individual package needs to be
installed, the name of the package group needs to start with an at sign
(@), and the entire package group name needs to be put between single
quotes. Also notice the use of <strong>state: latest</strong> in <a
  href="#ch12.xhtml#list12_3">Listing
12-3</a>. This line ensures that the packages in the
package group are installed if they have not been installed yet. If they
have already been installed, they are updated to the latest version.</p>
<p>A new feature in RHEL 8 is the yum AppStream module. Modules as listed
by the Linux <strong>yum modules list</strong> command can be managed with the
Ansible yum module also. Working with yum modules is similar to working
with yum package groups. In the example in <a
  href="#ch12.xhtml#list12_4">Listing
12-4</a>, the main difference is that a version
number and the installation profile are included in the module name.</p>
<p><strong>Listing 12-4</strong> Installing AppStream Modules with the yum Module</p>
<p>::: pre_1
&mdash;
- name: installing an AppStream module
hosts: ansible2
tasks:
- name: install or update an AppStream module
yum:
name: ’@php:7.3/devel’
state: present
:::</p>
<p>::: note</p>
<hr>
<p><strong>Note</strong></p>
<p>When using the yum module to install multiple packages, you can provide
the <strong>name</strong> argument with a list of multiple packages. Alternatively,
you can provide multiple packages in a loop. Of these solutions, using a
list of multiple packages as the argument to <strong>name</strong> is always
preferred. If multiple package names are provided in a loop, the module
must execute a task for every single package. If multiple package names
are provided as the argument to <strong>name</strong>, yum can install all these
packages in one single task.</p>
<hr>
<p>:::</p>

<h4 class="relative group">Managing Package Facts
    <div id="managing-package-facts" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#managing-package-facts" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>When Ansible is gathering facts, package facts are not included. To
include package facts as well, you need to run a separate task; that is,
you need to use the package_facts module. Facts that have been gathered
about packages are stored to the ansible_facts.packages variable. The
sample playbook in <a
  href="#ch12.xhtml#list12_5">Listing 12-5</a> shows how to use
the package_facts module.</p>
<p><strong>Listing 12-5</strong> Using the package_facts Module to Show Package Details</p>
<p>::: pre_1
&mdash;
- name: using package facts
hosts: ansible2
vars:
my_package: nmap
tasks:
- name: install package
yum:
name: &ldquo;{{ my_package }}&rdquo;
state: present
- name: update package facts
package_facts:
manager: auto
- name: show package facts for {{ my_package }}
debug:
var: ansible_facts.packages[my_package]
when: my_package in ansible_facts.packages
:::</p>
<p>As you can see, the package_facts module does not need much to do its
work. The only argument used here is the <strong>manager</strong> argument, which
specifies which package manager to communicate to. Its default value of
<strong>auto</strong> automatically detects the appropriate package manager and uses
that. If you want, you can specify the package manager manually, using
any package manager such as yum or dnf. <a
  href="#ch12.xhtml#list12_6">Listing
12-6</a> shows the output of running the <a
  href="#ch12.xhtml#list12_5">Listing
12-5</a> playbook, where you can see details that are
collected by the package_facts module.</p>
<p><strong>Listing 12-6</strong> Running <strong>ansible-playbook listing125.yaml</strong> Results</p>
<p>::: pre_1
[ansible@control rhce8-book]$ ansible-playbook listing125.yaml</p>
<pre><code>PLAY [using package facts] **************************************************************

TASK [Gathering Facts] ******************************************************************
ok: [ansible2]

TASK [install package] ******************************************************************
ok: [ansible2]

TASK [update package facts] *************************************************************
ok: [ansible2]

TASK [show package facts for my_package] ************************************************
ok: [ansible2] =&gt; {
    &quot;ansible_facts.packages[my_package]&quot;: [
        {
            &quot;arch&quot;: &quot;x86_64&quot;,
            &quot;epoch&quot;: 2,
            &quot;name&quot;: &quot;nmap&quot;,
            &quot;release&quot;: &quot;5.el8&quot;,
            &quot;source&quot;: &quot;rpm&quot;,
            &quot;version&quot;: &quot;7.70&quot;
        }
    ]
}

PLAY RECAP ******************************************************************************
ansible2                   : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</code></pre>
<p>:::</p>
<p>In <a
  href="#ch12.xhtml#exe12_1">Exercise 12-1</a> you can practice working with
the different tools Ansible provides for module management.</p>
<p>::: box
<strong>Exercise 12-1 Managing Software Packages</strong></p>
<p>1. Use your editor to create a new file with the name exercise121.yaml.</p>
<p>2. Write a play header that defines the variable <strong>my_package</strong> and
sets its value to <strong>virt-manager</strong>:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: exercise121
  hosts: ansible2
  vars:
    my_package: virt-manager
  tasks:
</code></pre><p>3. Add a task that installs the package based on the name of the
variable that was provided:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: install package
  yum:
    name: &#34;{{ my_package }}&#34;
    state: present
</code></pre><p>4. Add a task that gathers facts about installed packages:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: update package facts
  package_facts:
    manager: auto
</code></pre><p>5. As the last part of this exercise, add a task that shows facts about
the package that you have just installed:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: show package facts for {{ my_package }}
  debug:
    var: ansible_facts.packages[my_package]
  when: my_package in ansible_facts.packages
</code></pre><p>6. Run the playbook using <strong>ansible-playbook exercise121.yaml</strong> and
verify its output.
:::</p>

<h2 class="relative group">Using Modules to Manage Repositories and Subscriptions
    <div id="using-modules-to-manage-repositories-and-subscriptions" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#using-modules-to-manage-repositories-and-subscriptions" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>To work with software packages, you need to make sure that repositories
are accessible and subscriptions are available. In the previous section
you learned how to write a playbook that enables you to access an
existing repository. In this section you learn how to set up the server
part of a repository if that still needs to be done. Also, you learn how
to manage RHEL subscriptions using Ansible.</p>

<h4 class="relative group">Setting Up Repositories
    <div id="setting-up-repositories" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#setting-up-repositories" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Most managed systems access the default distributions that are provided
while installing the operating system. In some cases external
repositories might not be accessible. If that happens, you need to set
up a repository yourself. Before you can do that, however, it&rsquo;s
important to know what a repository is. A repository is a directory that
contains RPM files, as well as the repository metadata, which is an
index that allows the repository client to figure out which packages are
available in the repository.</p>
<p>Ansible does not provide a specific module to set up a repository. You
must use a number of modules instead. Exactly which modules are involved
depends on how you want to set up the repository. For instance, if you
want to set up an FTP-based repository on the Ansible control host, you
need to accomplish the following tasks:</p>
<p>• Install the FTP package.</p>
<p>• Start and enable the FTP server.</p>
<p>• Open the firewall for FTP traffic.</p>
<p>• Make sure the FTP shared repository directory is available.</p>
<p>• Download packages to the repository directory.</p>
<p>• Use the Linux <strong>createrepo</strong> command to generate the index that is
required in each repository.</p>
<p>The playbook in <a
  href="#ch12.xhtml#list12_7">Listing 12-7</a> provides an example
of how this can be done.</p>
<p><strong>Listing 12-7</strong> Setting Up an FTP-based Repository</p>
<p>::: pre_1
- name: install FTP to export repo
hosts: localhost
tasks:
- name: install FTP server
yum:
name:
- vsftpd
- createrepo_c
state: latest
- name: start FTP server
service:
name: vsftpd
state: started
enabled: yes
- name: open firewall for FTP
firewalld:
service: ftp
state: enabled
permanent: yes</p>
<pre><code>- name: setup the repo directory
  hosts: localhost
  tasks:
  - name: make directory
    file:
      path: /var/ftp/repo
      state: directory
  - name: download packages
    yum:
      name: nmap
      download_only: yes
      download_dir: /var/ftp/repo
  - name: createrepo
    command: createrepo /var/ftp/repo
</code></pre>
<p>:::</p>
<p>The most significant tasks in setting up the repository are the
<strong>download packages</strong> and <strong>createrepo</strong> tasks. In the <strong>download
packages</strong> task, the yum module is used to download a single package. To
do so, the <strong>download_only</strong> argument is used to ensure that the package
is not installed but downloaded to a directory. When you use the
<strong>download_only</strong> argument, you also must specify where the package
needs to be installed. To do this, the task uses the <strong>download_dir</strong>
argument.</p>
<p>There is one disadvantage in using this approach to download the
package, though: it requires repository access. If repository access is
not available, the fetch module can be used instead to download a file
from a specific URL.</p>

<h4 class="relative group">Managing GPG Keys
    <div id="managing-gpg-keys" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#managing-gpg-keys" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>To guarantee the integrity of packages, most repositories are set up
with a GPG key. This enables the client to verify that packages have not
been tampered with while transmitted between the repository server and
client. For that reason, if packages are installed from a repository
server on the Internet, you should always make sure that <strong>gpgcheck:
yes</strong> is set while using the yum_repository module.</p>
<p>However, if you want to make sure that a GPG check is performed, you
need to make sure the client knows where to fetch the repository key. To
help with that, you can use the rpm_key module. You can see how to do
this in <a
  href="#ch12.xhtml#list12_8">Listing 12-8</a>. Notice that the playbook
in this listing doesn&rsquo;t work because no GPG-protected repository is
available. Setting up GPG-protected repositories is complex and outside
the scope of the EX294 objectives, and for that reason is not covered
here.</p>
<p><strong>Listing 12-8</strong> Using rpm_key to Fetch an RPM Key</p>
<p>::: pre_1
- name: use rpm_key in repository access
hosts: all
tasks:
- name: get the GPG public key
rpm_key:
key: <a
  href="ftp://control.example.com/repo/RPM-GPG-KEY">ftp://control.example.com/repo/RPM-GPG-KEY</a>
state: present
- name: set up the repository client
yum_repository:
file: myrepo
name: myrepo
description: example repo
baseurl: <a
  href="ftp://control.example.com/repo">ftp://control.example.com/repo</a>
enabled: yes
gpgcheck: yes
state: present
:::</p>

<h4 class="relative group">Managing RHEL Subscriptions
    <div id="managing-rhel-subscriptions" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#managing-rhel-subscriptions" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>When you work with Red Hat Enterprise Linux, configuring repository
access using the method described before is not enough. Red Hat
Enterprise Linux works with subscriptions, and to be able to access
software that is provided through your subscription entitlement, you
need to set up managed systems to access these subscriptions.</p>
<p>::: note</p>
<hr>
<p><strong>Tip</strong></p>
<p>Free developer subscriptions are available for RHEL as well as Ansible.
Register yourself at <a
  href="https://developers.redhat.com"
    target="_blank"
  >https://developers.redhat.com</a> and sign up for a
free subscription if you want to test the topics described in this
section on RHEL and you don&rsquo;t have a valid subscription yet.</p>
<hr>
<p>:::</p>
<p>To understand how to use the Ansible modules to register a RHEL system,
you need to understand how to use the Linux command-line utilities. When
you are managing subscriptions from the Linux command line, multiple
steps are involved.</p>
<p>1. First, you use the <strong>subscription-manager register</strong> command to
provide your RHEL credentials. Use, for instance, <strong>subscription-manager
register --username=yourname --password=yourpassword</strong>.</p>
<p>2. Next, you need to find out which pools are available in your
account. A pool is a collection of software channels available to your
account. Use <strong>subscription-manager list --available</strong> for an overview.</p>
<p>3. Now you can connect to a specific pool using <strong>subscription-manager
attach --pool=<em>poolID</em></strong>. Note that if only one subscription pool is
available in your account, you don&rsquo;t have to provide the <strong>--pool</strong>
argument.</p>
<p>4. Next, you need to find out which additional repositories are
available to your account by using <strong>subscription-manager repos
--list</strong>.</p>
<p>5. To register to use additional repositories, you use
<strong>subscription-manager repos --enable &ldquo;repos name&rdquo;</strong>. Your system then
has full access to its subscription and related repositories.</p>
<p>Two significant modules are provided by Ansible:</p>
<p>• <strong>redhat_subscription:</strong> This module enables you to perform
subscription and registration in one task.</p>
<p>• <strong>rhsm_repository:</strong> This module enables you to add subscription
manager repositories.</p>
<p><a
  href="#ch12.xhtml#list12_9">Listing 12-9</a> shows an example of a playbook that
uses these modules to fully register a new RHEL 8 machine and add a new
repository to the managed machine. Notice that this playbook is not
runnable as such because important additional information needs to be
provided. <a
  href="#ch12.xhtml#exe12_3">Exercise 12-3</a>, later in the section
titled &ldquo;Implementing a Playbook to Manage Software,&rdquo; will guide you to a
scenario that shows how to use this code in production.</p>
<p><strong>Listing 12-9</strong> Using Subscription Manager to Set Up Ansible</p>
<p>::: pre_1
&mdash;
- name: use subscription manager to register and set up repos
hosts: ansible5
tasks:
- name: register and subscribe ansible5
redhat_subscription:
username: <a
  href="mailto:bob@example.com">bob@example.com</a>
password: verysecretpassword
state: present
- name: configure additional repo access
rhsm_repository:
name:
- rh-gluster-3-client-for-rhel-8-x86_64-rpms
- rhel-8-for-x86_64-appstream-debug-rpms
state: present
:::</p>
<p>In the sample playbook in <a
  href="#ch12.xhtml#list12_9">Listing 12-9</a>, you can
see how the redhat_subscription and rhsm_repository modules are used.
Notice that redhat_subscription requires a password. In <a
  href="#ch12.xhtml#list12_9">Listing
12-9</a> the username and password are provided as
clear-text values in the playbook. From a security perspective, this is
very bad practice. You should use Ansible Vault instead. <a
  href="#ch12.xhtml#exe12_3">Exercise
12-3</a> will guide you through a setup where this is
done.</p>
<p>In <a
  href="#ch12.xhtml#exe12_2">Exercise 12-2</a> you are guided through the
procedure of setting up your own repository and using it. This procedure
consists of two distinct parts. In the first part you set up a
repository server that is based on FTP. Because in Ansible you often
need to configure topics that don&rsquo;t have your primary attention, you set
up the FTP server and also change its configuration. Next, you write a
second playbook that configures the clients with appropriate repository
access, and after doing so, install a package.</p>
<p>::: box
<strong>Exercise 12-2 Setting Up a Repository</strong></p>
<p>1. Use your editor to create the file exercise122-server.yaml.</p>
<p>2. Define the play that sets up the basic FTP configuration. Because
all its tasks should be familiar to you at this point, you can enter all
the tasks at once:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: install, configure, start and enable FTP
  hosts: localhost
  tasks:
  - name: install FTP server
    yum:
      name: vsftpd
      state: latest
  - name: allow anonymous access to FTP
    lineinfile:
      path: /etc/vsftpd/vsftpd.conf
      regexp: ’^anonymous_enable=NO’
      line: anonymous_enable=YES
  - name: start FTP server
    service:
      name: vsftpd
      state: started
      enabled: yes
  - name: open firewall for FTP
    firewalld:
      service: ftp
      state: enabled
      immediate: yes
      permanent: yes
</code></pre><p>3. Set up a repository directory. Add the following play to the
playbook. Notice the use of the download packages task, which uses the
yum module to download a package without installing it. Also notice the
createrepo task, which creates the repository metadata that converts the
/var/ftp/repo directory into a repository.</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: setup the repo directory
  hosts: localhost
  tasks:
  - name: make directory
    file:
      path: /var/ftp/repo
      state: directory
  - name: download packages
    yum:
      name: nmap
      download_only: yes
      download_dir: /var/ftp/repo
  - name: install createrepo package
    yum:
      name: createrepo_c
      state: latest
  - name: createrepo
    command: createrepo /var/ftp/repo
    notify:
    - restart_ftp
  handlers:
  - name: restart_ftp
    service:
      name: vsftpd
      state: restarted
</code></pre><p>4. Use the command <strong>ansible-playbook exercise122-server.yaml</strong> to set
up the FTP server on control.example.com. If you haven&rsquo;t made any typos,
you shouldn&rsquo;t encounter any errors.</p>
<p>5. Now that the repository server has been installed, it&rsquo;s time to set
up the repository client. Use your editor to create the file
exercise122-client.yaml and write the play header as follows:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: configure repository
  hosts: all
  vars:
    my_package: nmap
  tasks:
</code></pre><p>6. Add a task that uses the yum_repository module to configure access
to the new repository:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: connect to example repo
  yum_repository:
    name: exercise122
    description: RHCE8 exercise 122 repo
    file: exercise122
    baseurl: ftp://control.example.com/repo/
    gpgcheck: no
</code></pre><p>7. After setting up the repository client, you also need to make sure
that the clients know how to reach the repository server by addressing
its name. Add the next task that writes a new line to /etc/hosts to make
sure host name resolving on the clients is set up correctly:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: ensure control is resolvable
  lineinfile:
    path: /etc/hosts
    line: 192.168.4.200  control.example.com  control

- name: install package
  yum:
    name: &#34;{{ my_package }}&#34;
    state: present
</code></pre><p>8. If you are using the package_facts module, you need to remember to
update it after installing new packages. Add the following task to get
this done:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: update package facts
  package_facts:
    manager: auto
</code></pre><p>9. As the last task, just because it&rsquo;s fun, use the debug module
together with the package facts to get information about the newly
installed package:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: show package facts for {{ my_package }}
  debug:
    var: ansible_facts.packages[my_package]
  when: my_package in ansible_facts.packages
</code></pre><p>10. Use the command <strong>ansible-playbook exercise122-client.yaml -e
my_package=redis</strong>. That&rsquo;s right; this command overwrites the my_package
variable that was set in the playbook&mdash;just to remind you a bit about
variable precedence.
:::</p>

          
          
          
        </div>
        
        

        

        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js"
          integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="
          data-oid="views_tech notes/RHCE/Managing Packages Repositories and Subscriptions with Ansible.md"
          data-oid-likes="likes_tech notes/RHCE/Managing Packages Repositories and Subscriptions with Ansible.md"></script>
      
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      

      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
      
      
        
      
      
      
      
      <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 overflow-x-auto py-2">
        <ul class="flex list-none flex-row">
          
            <li class=" flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 me-4">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href=""
                title="">
                
                
              </a>
            </li>
          
        </ul>
      </nav>
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2025
          David Thomas
      </p>
    

    
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="http://localhost:1313/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
