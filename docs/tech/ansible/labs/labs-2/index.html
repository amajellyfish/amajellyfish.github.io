<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="false"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title> &middot; David Thomas</title>
    <meta name="title" content=" &middot; David Thomas">
  

  
  
  
  
  
  <link rel="canonical" href="http://localhost:1313/tech/ansible/labs/labs-2/">
  

  
  
    <meta name="author" content="David Thomas">
  
  

  
  <meta property="og:url" content="http://localhost:1313/tech/ansible/labs/labs-2/">
  <meta property="og:site_name" content="David Thomas">
  <meta property="og:title" content="David Thomas">
  <meta property="og:description" content="Managing Users Advanced Scenario Exercise # It’s time to work on an advanced scenario now. Exercise 13-4 includes a step-by-step procedure that guides you through the process of setting up a complex playbook. In this procedure I tried to give you practical guidelines on how to approach such a complex task on the exam, including the part where you may change your mind because you have realized there is a more efficient method. It is important to read the steps carefully because some improvements will be applied while working on this procedure.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tech">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="David Thomas">
  <meta name="twitter:description" content="Managing Users Advanced Scenario Exercise # It’s time to work on an advanced scenario now. Exercise 13-4 includes a step-by-step procedure that guides you through the process of setting up a complex playbook. In this procedure I tried to give you practical guidelines on how to approach such a complex task on the exam, including the part where you may change your mind because you have realized there is a more efficient method. It is important to read the steps carefully because some improvements will be applied while working on this procedure.">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
  
  
  
  

  

  
  
  
  
  
  
  
    
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.c5c4ab59b36e3a06d6dff38478af5d2c18b2d7a3603611d7fc5647b02111f989bd5957610b6bed4d10718428186bc7c38590e84c77c0d50f401da78f4fbb5384.css"
    integrity="sha512-xcSrWbNuOgbW3/OEeK9dLBiy16NgNhHX/FZHsCER&#43;Ym9WVdhC2vtTRBxhCgYa8fDhZDoTHfA1Q9AHaePT7tThA==">

  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
  
    
    <script src="/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js" integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7&#43;kfJ6kKCJxQGC&#43;8wm&#43;Bz9JucDjDTGNew=="></script>
  

  
  
  
    
  
  
    
  
  
    
  
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js"
      integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP&#43;pSqMXxm6JPOUeAg=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>


























  

  

  

  

  





  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "",
    "name": "",
    "headline": "",
    
    "abstract": "\u003ch3 class=\u0022relative group\u0022\u003eManaging Users Advanced Scenario Exercise\n    \u003cdiv id=\u0022managing-users-advanced-scenario-exercise\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#managing-users-advanced-scenario-exercise\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h3\u003e\n\u003cp\u003eIt\u0026rsquo;s time to work on an advanced scenario now. \u003ca\n  href=\u0022#ch13.xhtml#exe13_4\u0022\u003eExercise\n13-4\u003c\/a\u003e includes a step-by-step procedure that guides\nyou through the process of setting up a complex playbook. In this\nprocedure I tried to give you practical guidelines on how to approach\nsuch a complex task on the exam, including the part where you may change\nyour mind because you have realized there is a more efficient method. It\nis important to read the steps carefully because some improvements will\nbe applied while working on this procedure.\u003c\/p\u003e",
    "inLanguage": "en",
    "url" : "http://localhost:1313/tech/ansible/labs/labs-2/",
    "author" : {
      "@type": "Person",
      "name": "David Thomas"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "1762"
  }]
  </script>



  
  

  
  

  
  

  
  
    
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
      <script>

    const firebaseConfig = {
      apiKey: "AIzaSyApsKLCbGb5fkkrzxABOtl3-OUuBcRPVsc",
      authDomain: "davidwrites-89dd7.firebaseapp.com",
      projectId: "davidwrites-89dd7",
      storageBucket: "davidwrites-89dd7.firebasestorage.app",
      messagingSenderId: "433139099634",
      appId: "1:433139099634:web:c14275555bd7171e6c6d6b",
      measurementId: "G-XX5507B82W"
    };

        var app = firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();
        var auth = firebase.auth();

      </script>
    
  

  
  
</head>







  
    
  







  
    
  






  
  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      













<div
  class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0">
  
  
    
    

  <div class="flex flex-1 items-center justify-between">
    <nav class="flex space-x-3">
      
        <a href="/" class="text-base font-medium">
          David Thomas
        </a>
      
    </nav>
    
  <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">
    
      
        
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a
      
      aria-label="Tech"
      class="text-base font-medium hover:text-primary-600 dark:hover:text-primary-400"
      title="">
      <p>
        Tech
      </p>
    </a>
    <span>
      <span class="relative block icon"><svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>
</span>
    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
          <a
            href="/tech/networking/"
            
            aria-label="Networking"
            class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
            
            <p class="text-sm font-sm" title="">
              Networking
            </p>
          </a>
        
          <a
            href="/tech/linux/"
            
            aria-label="Linux"
            class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
            
            <p class="text-sm font-sm" title="">
              Linux
            </p>
          </a>
        
          <a
            href="/tech/ansible/"
            
            aria-label="Ansible"
            class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
            
            <p class="text-sm font-sm" title="Ansible">
              Ansible
            </p>
          </a>
        
          <a
            href="/tech/podman/"
            
            aria-label="Podman"
            class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
            
            <p class="text-sm font-sm" title="">
              Podman
            </p>
          </a>
        
      </div>
    </div>
  </div>
</div>



      
        
  <a
  href="/notes/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Notes"
  title="Book Notes &amp; Reviews">
  
  
    <p class="text-base font-medium">
      Notes
    </p>
  
</a>



      
        
  <a
  href="/articles/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Articles"
  title="Articles">
  
  
    <p class="text-base font-medium">
      Articles
    </p>
  
</a>



      
        
  <a
  href="/now/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Now"
  title="Now">
  
  
    <p class="text-base font-medium">
      Now
    </p>
  
</a>



      
        
  <a
  href=""
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  
  title="">
  
  
</a>



      
    

    

    

    
      <button
        id="search-button"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
  </nav>

    
  <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">
    <span></span>

    

    

    
      <button
        id="search-button-mobile"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
  </div>

  </div>
  
  <div class="-my-2 md:hidden">
    <div id="menu-button" class="block">
      
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]">
          <ul
            class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl">
            <li id="menu-close-button">
              <span
                class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">
                <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
              </span>
            </li>

            
              
  <li class="mt-1">
  <a
    href=""
    aria-label="Tech"
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-bg font-bg" title="">
      Tech
    </p>
    <span>
      <span class="relative block icon"><svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>
</span>
    </span>
  </a>
</li>

  <li class="mt-1">
    <a
      href="/tech/networking/"
      
      aria-label="Networking"
      class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
      
      <p class="text-sm font-small" title="">
        Networking
      </p>
    </a>
  </li>

  <li class="mt-1">
    <a
      href="/tech/linux/"
      
      aria-label="Linux"
      class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
      
      <p class="text-sm font-small" title="">
        Linux
      </p>
    </a>
  </li>

  <li class="mt-1">
    <a
      href="/tech/ansible/"
      
      aria-label="Ansible"
      class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
      
      <p class="text-sm font-small" title="Ansible">
        Ansible
      </p>
    </a>
  </li>

  <li class="mt-1">
    <a
      href="/tech/podman/"
      
      aria-label="Podman"
      class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
      
      <p class="text-sm font-small" title="">
        Podman
      </p>
    </a>
  </li>

<li class="mb-2"></li>



            
              
  <li class="mt-1">
  <a
    href="/notes/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Notes"
    title="Book Notes &amp; Reviews">
    
    
      <p class="text-bg font-bg">
        Notes
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/articles/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Articles"
    title="Articles">
    
    
      <p class="text-bg font-bg">
        Articles
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/now/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Now"
    title="Now">
    
    
      <p class="text-bg font-bg">
        Now
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href=""
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    
    title="">
    
    
  </a>
</li>



            

          </ul>
          
        </div>
      
    </div>
  </div>

</div>




  <script>
    (function () {
      var $mainmenu = $(".main-menu");
      var path = window.location.pathname;
      $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
        $(e).children("p").addClass("active");
      });
    })();
  </script>


    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  

  

  

  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    

    
    
  </div>

  

  
  

  
  



      </div>
      
        
  
  
  
  
  
  

  

  

  

  

      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      
        <div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
          <div class="toc ps-5 print:hidden lg:sticky lg:top-10">
            
              <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#managing-users-advanced-scenario-exercise">Managing Users Advanced Scenario Exercise</a></li>
        <li><a href="#h3_178">Lab 13-1</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#managing-users-advanced-scenario-exercise">Managing Users Advanced Scenario Exercise</a></li>
        <li><a href="#h3_178">Lab 13-1</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>


<script>
  (function () {
    'use strict'

    const SCROLL_OFFSET_RATIO = 0.33
    const TOC_SELECTOR = '#TableOfContents'
    const ANCHOR_SELECTOR = '.anchor'
    const TOC_LINK_SELECTOR = 'a[href^="#"]'
    const NESTED_LIST_SELECTOR = 'li ul'
    const ACTIVE_CLASS = 'active'
    let isJumpingToAnchor = false

    function getActiveAnchorId(anchors, offsetRatio) {
      const threshold = window.scrollY + window.innerHeight * offsetRatio
      const tocLinks = [...document.querySelectorAll('#TableOfContents a[href^="#"]')]
      const tocIds = new Set(tocLinks.map(link => link.getAttribute('href').substring(1)))

      if (isJumpingToAnchor) {
        for (let i = 0; i < anchors.length; i++) {
          const anchor = anchors[i]
          if (!tocIds.has(anchor.id)) continue
          const top = anchor.getBoundingClientRect().top + window.scrollY
          if (Math.abs(window.scrollY - top) < 100) {
            return anchor.id
          }
        }
      }

      for (let i = anchors.length - 1; i >= 0; i--) {
        const top = anchors[i].getBoundingClientRect().top + window.scrollY
        if (top <= threshold && tocIds.has(anchors[i].id)) {
          return anchors[i].id
        }
      }
      return anchors.find(anchor => tocIds.has(anchor.id))?.id || ''
    }

    function updateTOC({ toc, anchors, links, scrollOffset, collapseInactive }) {
      const activeId = getActiveAnchorId(anchors, scrollOffset)
      if (!activeId) return

      links.forEach(link => {
        const isActive = link.getAttribute('href') === `#${activeId}`
        link.classList.toggle(ACTIVE_CLASS, isActive)

        if (collapseInactive) {
          const ul = link.closest('li')?.querySelector('ul')
          if (ul) ul.style.display = isActive ? '' : 'none'
        }
      })

      if (collapseInactive) {
        const activeLink = toc.querySelector(`a[href="#${CSS.escape(activeId)}"]`)
        let el = activeLink
        while (el && el !== toc) {
          if (el.tagName === 'UL') el.style.display = ''
          if (el.tagName === 'LI') el.querySelector('ul')?.style.setProperty('display', '')
          el = el.parentElement
        }
      }
    }

    function initTOC() {
      const toc = document.querySelector(TOC_SELECTOR)
      if (!toc) return

      const collapseInactive = true
      const anchors = [...document.querySelectorAll(ANCHOR_SELECTOR)]
      const links = [...toc.querySelectorAll(TOC_LINK_SELECTOR)]

      if (collapseInactive) {
        toc.querySelectorAll(NESTED_LIST_SELECTOR).forEach(ul => ul.style.display = 'none')
      }

      links.forEach(link => {
        link.addEventListener('click', () => {
          isJumpingToAnchor = true
        })
      })

      const config = {
        toc,
        anchors,
        links,
        scrollOffset: SCROLL_OFFSET_RATIO,
        collapseInactive
      }

      window.addEventListener('scroll', () => updateTOC(config), { passive: true })
      window.addEventListener('hashchange', () => updateTOC(config), { passive: true })

      updateTOC(config)
    }

    document.readyState === 'loading'
      ? document.addEventListener('DOMContentLoaded', initTOC)
      : initTOC()
  })()
</script>


            
          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        

        <div class="article-content max-w-prose mb-20">
          
<h3 class="relative group">Managing Users Advanced Scenario Exercise
    <div id="managing-users-advanced-scenario-exercise" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#managing-users-advanced-scenario-exercise" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>It&rsquo;s time to work on an advanced scenario now. <a
  href="#ch13.xhtml#exe13_4">Exercise
13-4</a> includes a step-by-step procedure that guides
you through the process of setting up a complex playbook. In this
procedure I tried to give you practical guidelines on how to approach
such a complex task on the exam, including the part where you may change
your mind because you have realized there is a more efficient method. It
is important to read the steps carefully because some improvements will
be applied while working on this procedure.</p>
<p>::: note</p>
<hr>
<p><strong>Warning</strong></p>
<p>This exercise is written such that you can learn from errors that are
made. In early steps, some configuration is created that will be
optimized later. I purposely used this approach, and you are advised to
closely follow the steps in the exercise before investigating the final
solution in the exercise134.yaml playbook.</p>
<hr>
<p>:::</p>
<p>::: box
<strong>Exercise 13-4 Setting Up Ansible Users</strong></p>
<p>In this exercise you create a few Ansible users. The users need to be
created on the Ansible control host as well as on the managed hosts, and
after running the playbook, any user created on the localhost must be
able to log in using SSH keys to the corresponding user account on the
remote host without having to enter a password. Make sure that the setup
meets the following requirements:</p>
<p>• Create users sharon, blair, ashley, and ahmed.</p>
<p>• Users sharon and blair are members of the group admins; users ashley
and ahmed are members of the group students.</p>
<p>• On the managed hosts, members of the group admins should have sudo
privileges to run any command they want.</p>
<p>• All users must be configured with the default password &ldquo;password&rdquo;.</p>
<p>1. This time you&rsquo;re going to use a different approach and set up the
framework of the playbook first. This is a good approach to start the
development of more complex playbooks and minimizes chances that you
miss anything in the playbook. To do so, use your editor to create a
file with the name exercise134.yaml, and define the play headers and the
names and modules you intend to use for each of the tasks according to
the following example:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: create users on localhost
  hosts: localhost
  tasks:
  - name: create groups
    groups:
  - name: create users
    users:

- name: create users on managed hosts
  hosts: ansible4
  tasks:
  - name: create groups
    groups:
  - name: create users
    users:
  - name: copy authorized keys
    authorized_key:
  - name: modify sudo configuration
    template
</code></pre><p>2. Now that you have defined the global structure, you can start
filling it in with details. Begin with the first play, which should
start with the creation of the user accounts. In this play, users and
groups need to be created. To start with, focus on the basic setup and
fill it in with additional details later:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: create users on localhost
  hosts: localhost
  vars:
    users:
    - username: sharon
      groups: admins
    - username: blair
      groups: admins
    - username: ashley
      groups: students
    - username: ahmed
      groups: students
  tasks:
  - name: create groups
    groups:
      name: &#34;{{ item.groups }}&#34;
      state: present
    loop: &#34;{{ users }}&#34;
  - name: create users
    user:
      name: &#34;{{ item.username }}&#34;
      groups: &#34;{{ item.groups }}&#34;
    loop: &#34;{{ users }}&#34;
</code></pre><p>3. Because you&rsquo;re in for a big project this time, now is a good moment
to give it a try. To do so, temporarily comment out the entire second
play and run the playbook in check mode by using <strong>ansible-playbook -C
exercise134.yaml</strong>. If you typed the exact text listed in step 2, you
get an error at the line where the groups module is referred to. That&rsquo;s
right&mdash;there is no groups module; the name is group. Correct this and
run the playbook again in check mode. Notice that in check mode you
might get false errors. Just double-check, and if you&rsquo;re convinced
you&rsquo;ve done it right, ignore the error. Notice that it also doesn&rsquo;t
really hurt if you just run the playbook. Any later modifications will
be added to the configuration anyway.</p>
<p>4. Now you&rsquo;re ready to complete the first play by adding the remaining
tasks to it. To do so, you still have to do two things, all of which
must be done on the user module: you need to set the user password, and
you need to create an SSH key pair. To generate the password, you need
to generate an encrypted string that can be used as an argument to the
user module <strong>password</strong> argument. To generate this string, use an ad
hoc command: <strong>ansible localhost -m debug -a &ldquo;msg={{ &lsquo;password&rsquo; |
password_hash(&lsquo;sha512&rsquo;, &lsquo;mysalt&rsquo;) }}&rdquo;</strong>. Just copy the crypto string
this generates (it starts with $6$) and use that in the next step.</p>
<p>5. Complete the user task in the first play with the
<strong>generate_ssh_key</strong> and <strong>password</strong> arguments. The complete task looks
as follows:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: create users
    user:
      name: &#34;{{ item.username }}&#34;
      groups: &#34;{{ item.groups }}&#34;
      generate_ssh_key: yes
      password: $6$mysalt$khiuhihrb8y349hwbohbuoehr8bhqohoibhro8bohoiheoi
    loop: &#34;{{ users }}&#34;
  tags: setuplocal
</code></pre><p>Notice the use of <strong>tags: setuplocal</strong> on the last line; this tag makes
it easier to run specific parts of the playbook only, which can be
convenient later in the setup procedure. You might want to run the
playbook now by using <strong>ansible-playbook exercise134.yaml
--tags=setuplocal</strong>.</p>
<p>6. At this point the local part of the setup seems to be done, so you
can work on the second play. You should start by observing what you&rsquo;re
trying to do. In the second play, a couple of tasks are exactly the same
as in the first play. Because just repeating the same stuff again
wouldn&rsquo;t be very efficient, you can create some imports instead and move
the existing code to a file that will be imported. To start with, create
the exercise134-vars.yaml file and give it the following contents:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
    users:
    - username: sharon
      groups: admins
    - username: blair
      groups: admins
    - username: ashley
      groups: students
    - username: ahmed
      groups: students
</code></pre><p>7. Create the exercise134-tasks.yaml file and give it the following
contents:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: create groups
    group:
      name: &#34;{{ item.groups }}&#34;
      state: present
    loop: &#34;{{ users }}&#34;
- name: create users
    user:
      name: &#34;{{ item.username }}&#34;
      groups: &#34;{{ item.groups }}&#34;
      generate_ssh_key: yes
      ssh_key_comment: &#34;{{ item.username }}@{{ ansible_fqdn }}&#34;
      password: $6$mysalt$khiuhihrb8y349hwbohbuoehr8bhqohoibhro8bohoiheoi
    loop: &#34;{{ users }}&#34;
</code></pre><p>8. Now it&rsquo;s time to rewrite the playbook so that the entire playbook
looks as follows (note that the last two tasks still need to be
defined):</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: create users on localhost
  hosts: localhost
  vars_files:
  - exercise134-vars.yaml
  tasks:
  - name: include user and group setup
    import_tasks: exercise134-tasks.yaml
  tags: setuplocal

- name: create users on managed hosts
  hosts: ansible4
  vars_files:
  - exercise134-vars.yaml
  tasks:
  - name: include user and group setup
    import_tasks: exercise134-tasks.yaml
  - name: copy authorized keys
    authorized_key:
  - name: modify sudo configuration
</code></pre><p>9. You can work on the copy authorized keys tasks at this point.
Because the users were created on localhost and each user has its own
SSH key pair, this step appears to be fairly easy. The challenge in this
task is the use of the lookup plug-in. Complete the authorized_key task
such that the second play looks as follows:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: create users on managed hosts
  hosts: ansible4
  vars_files:
  - exercise134-vars.yaml
  tasks:
  - name: include user and group setup
    import_tasks: exercise134-tasks.yaml
  - name: copy authorized keys
    authorized_key:
      user: &#34;{{ item.username }}&#34;
      key: &#34;{{ lookup(‘file’, ‘/home/’+ item.username + ‘/.ssh/id_rsa.pub’) }}&#34;
    loop: &#34;{{ users }}&#34;
  - name: modify sudo configuration
  tags: setupremote
</code></pre><p>10. Because you can easily make an error while using the lookup
plug-in, it&rsquo;s a good idea to run the second play by using
<strong>ansible-playbook exercise134.yaml --tags=setupremote</strong>. Notice that
this play works only if the first play has been executed successfully.
And oops! That doesn&rsquo;t work out well! You can see the error shown in
<a
  href="#ch13.xhtml#list13_15">Listing 13-15</a>. This error is generated because
the authorized_keys module cannot access the id_rsa.pub file directly
from the hidden .ssh directory in the user home directory.</p>
<p><strong>Listing 13-15</strong> Task 10 Error Output</p>
<p>::: pre_1</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">TASK [copy authorized keys] *******************************************************
[WARNING]: Unable to find ‘/home/laksmi/id_rsa.pub’ in expected paths (use -vvvvv
to see paths)
fatal: [ansible3]: FAILED! =&gt; {&#34;msg&#34;: &#34;An unhandled exception occurred while running the lookup plugin ‘file’. Error was a &lt;class ‘ansible.errors.AnsibleError’&gt;, original message: could not locate file in lookup: /home/laksmi/id_rsa.pub&#34;}
</code></pre><p>:::</p>
<p>11. To fix the error that occurred in step 10, you must rewrite the
first play with the solution discussed in the earlier section &ldquo;Managing
SSH Connections.&rdquo; The following code shows the entire first play, with
the modifications you need to make applied after the <strong>import_tasks:</strong>
statement:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: create users on localhost
  hosts: localhost
  vars_files:
  - exercise134-vars.yaml
  tasks:
  - name: include user and group setup
    import_tasks: exercise134-tasks.yaml
  - name: create a directory to store the key file
    file:
      name: &#34;{{ item.username }}&#34;
      state: directory
    loop: &#34;{{ users }}&#34;
  - name: copy the local user ssh key to temporary {{ item.username }} key
    shell: ‘cat /home/{{ item.username }}/.ssh/id_rsa.pub &gt; {{ item.username }}/id_rsa.pub’
    loop: &#34;{{ users }}&#34;
  - name: verify that file exists
    command: ls -l {{ item.username }}/
    loop: &#34;{{ users }}&#34;
  tags: setuplocal
</code></pre><p>12. Now it&rsquo;s time to configure the sudo file in the /etc/sudoers.d/
directory. While you&rsquo;ve been setting up the rough structure of the
playbook so far, using the template module has been suggested. But the
fact is that the file that needs to be created is simple and
straightforward, and just needs to contain the line <strong>%admins
ALL=(ALL:ALL) NOPASSWD:ALL</strong>. Because this is a simple task, you don&rsquo;t
need to use the template module. Just use the copy module instead, such
that after the authorized_key task, only the following task is included:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: copy sudoers file
  copy:
    content: ‘%admins ALL=(ALL:ALL) NOPASSWD:ALL’
    dest: /etc/sudoers.d/admins
</code></pre><p>13. Before running the playbook, you may verify what you have typed
with the sample playbook in the GitHub repository at
<a
  href="https://github.com/sandervanvugt/rhce8-book/exercise134.yaml"
    target="_blank"
  >https://github.com/sandervanvugt/rhce8-book/exercise134.yaml</a>.</p>
<p>14. At this point, you can run the playbook by using <strong>ansible-playbook
exercise134.yaml</strong>, and you should encounter no errors.</p>
<p>15. To verify that all works well, on the control host, type <strong>sudo
su - ahmed</strong>, and once in a shell as user ahmed, type <strong>ssh ansible2</strong>.
Ansible should let the user in without asking for a password.
:::</p>

<h3 class="relative group">Lab 13-1
    <div id="h3_178" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#h3_178" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Write a playbook that creates users according to the following
specifications:</p>
<p>• Create users kim, christina, kelly, and bill.</p>
<p>• Users kim and kelly must be members of the profs group; users
christina and bill are members of the students group.</p>
<p>• While creating the users, set the encrypted password to &ldquo;password&rdquo;.</p>
<p>• Ensure that members of the group profs have sudo privileges.
:::</p>
<p>[]{#ch14.xhtml}</p>
<p>::: {#ch14.xhtml#sbo-rt-content}</p>

          
          
          
        </div>
        
        

        

        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js"
          integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="
          data-oid="views_tech/ansible/labs/Labs 2.md"
          data-oid-likes="likes_tech/ansible/labs/Labs 2.md"></script>
      
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      

      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
      
      
        
      
      
      
      
      <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 overflow-x-auto py-2">
        <ul class="flex list-none flex-row">
          
            <li class=" flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 me-4">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href=""
                title="">
                
                
              </a>
            </li>
          
        </ul>
      </nav>
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2025
          David Thomas
      </p>
    

    
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="http://localhost:1313/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
