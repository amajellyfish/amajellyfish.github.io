<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="false"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title> &middot; David Thomas</title>
    <meta name="title" content=" &middot; David Thomas">
  

  
  
  
  
  
  <link rel="canonical" href="http://localhost:1313/tech/ansible/ansible4devops/chapter-6---playbook-organization---roles-and-includes/">
  

  
  
    <meta name="author" content="David Thomas">
  
  

  
  <meta property="og:url" content="http://localhost:1313/tech/ansible/ansible4devops/chapter-6---playbook-organization---roles-and-includes/">
  <meta property="og:site_name" content="David Thomas">
  <meta property="og:title" content="David Thomas">
  <meta property="og:description" content="Chapter 6 - Playbook Organization - Roles and Includes # So far, we’ve used fairly straightforward examples in this book. Most examples are created for a particular server, and are in one long playbook.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tech">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="David Thomas">
  <meta name="twitter:description" content="Chapter 6 - Playbook Organization - Roles and Includes # So far, we’ve used fairly straightforward examples in this book. Most examples are created for a particular server, and are in one long playbook.">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
  
  
  
  

  

  
  
  
  
  
  
  
    
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.c5c4ab59b36e3a06d6dff38478af5d2c18b2d7a3603611d7fc5647b02111f989bd5957610b6bed4d10718428186bc7c38590e84c77c0d50f401da78f4fbb5384.css"
    integrity="sha512-xcSrWbNuOgbW3/OEeK9dLBiy16NgNhHX/FZHsCER&#43;Ym9WVdhC2vtTRBxhCgYa8fDhZDoTHfA1Q9AHaePT7tThA==">

  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
  
    
    <script src="/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js" integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7&#43;kfJ6kKCJxQGC&#43;8wm&#43;Bz9JucDjDTGNew=="></script>
  

  
  
  
    
  
  
    
  
  
    
  
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js"
      integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP&#43;pSqMXxm6JPOUeAg=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>


























  

  

  

  

  





  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "",
    "name": "",
    "headline": "",
    
    "abstract": "\u003ch2 class=\u0022relative group\u0022\u003eChapter 6 - Playbook Organization - Roles and Includes\n    \u003cdiv id=\u0022chapter-6---playbook-organization---roles-and-includes\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#chapter-6---playbook-organization---roles-and-includes\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h2\u003e\n\u003cp\u003eSo far, we\u0026rsquo;ve used fairly straightforward examples in this book. Most\nexamples are created for a particular server, and are in one long\nplaybook.\u003c\/p\u003e",
    "inLanguage": "en",
    "url" : "http://localhost:1313/tech/ansible/ansible4devops/chapter-6---playbook-organization---roles-and-includes/",
    "author" : {
      "@type": "Person",
      "name": "David Thomas"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "4788"
  }]
  </script>



  
  

  
  

  
  

  
  
    
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
      <script>

    const firebaseConfig = {
      apiKey: "AIzaSyApsKLCbGb5fkkrzxABOtl3-OUuBcRPVsc",
      authDomain: "davidwrites-89dd7.firebaseapp.com",
      projectId: "davidwrites-89dd7",
      storageBucket: "davidwrites-89dd7.firebasestorage.app",
      messagingSenderId: "433139099634",
      appId: "1:433139099634:web:c14275555bd7171e6c6d6b",
      measurementId: "G-XX5507B82W"
    };

        var app = firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();
        var auth = firebase.auth();

      </script>
    
  

  
  
</head>







  
    
  







  
    
  






  
  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      













<div
  class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0">
  
  
    
    

  <div class="flex flex-1 items-center justify-between">
    <nav class="flex space-x-3">
      
        <a href="/" class="text-base font-medium">
          David Thomas
        </a>
      
    </nav>
    
  <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">
    
      
        
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a
      
      aria-label="Tech"
      class="text-base font-medium hover:text-primary-600 dark:hover:text-primary-400"
      title="">
      <p>
        Tech
      </p>
    </a>
    <span>
      <span class="relative block icon"><svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>
</span>
    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
          <a
            href="/tech/networking/"
            
            aria-label="Networking"
            class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
            
            <p class="text-sm font-sm" title="">
              Networking
            </p>
          </a>
        
          <a
            href="/tech/linux/"
            
            aria-label="Linux"
            class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
            
            <p class="text-sm font-sm" title="">
              Linux
            </p>
          </a>
        
          <a
            href="/tech/ansible/"
            
            aria-label="Ansible"
            class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
            
            <p class="text-sm font-sm" title="Ansible">
              Ansible
            </p>
          </a>
        
          <a
            href="/tech/podman/"
            
            aria-label="Podman"
            class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
            
            <p class="text-sm font-sm" title="">
              Podman
            </p>
          </a>
        
      </div>
    </div>
  </div>
</div>



      
        
  <a
  href="/notes/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Notes"
  title="Book Notes &amp; Reviews">
  
  
    <p class="text-base font-medium">
      Notes
    </p>
  
</a>



      
        
  <a
  href="/articles/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Articles"
  title="Articles">
  
  
    <p class="text-base font-medium">
      Articles
    </p>
  
</a>



      
        
  <a
  href="/now/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Now"
  title="Now">
  
  
    <p class="text-base font-medium">
      Now
    </p>
  
</a>



      
        
  <a
  href=""
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  
  title="">
  
  
</a>



      
    

    

    

    
      <button
        id="search-button"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
  </nav>

    
  <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">
    <span></span>

    

    

    
      <button
        id="search-button-mobile"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
  </div>

  </div>
  
  <div class="-my-2 md:hidden">
    <div id="menu-button" class="block">
      
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]">
          <ul
            class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl">
            <li id="menu-close-button">
              <span
                class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">
                <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
              </span>
            </li>

            
              
  <li class="mt-1">
  <a
    href=""
    aria-label="Tech"
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-bg font-bg" title="">
      Tech
    </p>
    <span>
      <span class="relative block icon"><svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>
</span>
    </span>
  </a>
</li>

  <li class="mt-1">
    <a
      href="/tech/networking/"
      
      aria-label="Networking"
      class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
      
      <p class="text-sm font-small" title="">
        Networking
      </p>
    </a>
  </li>

  <li class="mt-1">
    <a
      href="/tech/linux/"
      
      aria-label="Linux"
      class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
      
      <p class="text-sm font-small" title="">
        Linux
      </p>
    </a>
  </li>

  <li class="mt-1">
    <a
      href="/tech/ansible/"
      
      aria-label="Ansible"
      class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
      
      <p class="text-sm font-small" title="Ansible">
        Ansible
      </p>
    </a>
  </li>

  <li class="mt-1">
    <a
      href="/tech/podman/"
      
      aria-label="Podman"
      class="flex items-center hover:text-primary-600 dark:hover:text-primary-400">
      
      <p class="text-sm font-small" title="">
        Podman
      </p>
    </a>
  </li>

<li class="mb-2"></li>



            
              
  <li class="mt-1">
  <a
    href="/notes/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Notes"
    title="Book Notes &amp; Reviews">
    
    
      <p class="text-bg font-bg">
        Notes
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/articles/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Articles"
    title="Articles">
    
    
      <p class="text-bg font-bg">
        Articles
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/now/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Now"
    title="Now">
    
    
      <p class="text-bg font-bg">
        Now
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href=""
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    
    title="">
    
    
  </a>
</li>



            

          </ul>
          
        </div>
      
    </div>
  </div>

</div>




  <script>
    (function () {
      var $mainmenu = $(".main-menu");
      var path = window.location.pathname;
      $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
        $(e).children("p").addClass("active");
      });
    })();
  </script>


    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  

  

  

  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    

    
    
  </div>

  

  
  

  
  



      </div>
      
        
  
  
  
  
  
  

  

  

  

  

      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      
        <div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
          <div class="toc ps-5 print:hidden lg:sticky lg:top-10">
            
              <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#chapter-6---playbook-organization---roles-and-includes">Chapter 6 - Playbook Organization - Roles and Includes</a>
      <ul>
        <li><a href="#chap08.xhtml_leanpub-auto-includes">Includes</a>
          <ul>
            <li><a href="#chap08.xhtml_leanpub-auto-dynamic-includes">Dynamic includes</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-handler-includes">Handler includes</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-playbook-includes">Playbook includes</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-complete-includes-example">Complete includes example</a></li>
          </ul>
        </li>
        <li><a href="#chap08.xhtml_leanpub-auto-roles">Roles</a>
          <ul>
            <li><a href="#chap08.xhtml_leanpub-auto-role-scaffolding">Role scaffolding</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-building-your-first-role">Building your first role</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#chap08.xhtml_leanpub-auto-more-flexibility-with-role-vars-and-defaults">More flexibility with role vars and defaults</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-other-role-parts-handlers-files-and-templates">Other role parts: handlers, files, and templates</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-organizing-more-complex-and-cross-platform-roles">Organizing more complex and cross-platform roles</a></li>
          </ul>
        </li>
        <li><a href="#chap08.xhtml_leanpub-auto-ansible-galaxy">Ansible Galaxy</a>
          <ul>
            <li><a href="#chap08.xhtml_leanpub-auto-getting-roles-from-galaxy">Getting roles from Galaxy</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-a-lamp-server-in-eight-lines-of-yaml">A LAMP server in eight lines of YAML</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-a-solr-server-in-eight-lines-of-yaml">A Solr server in eight lines of YAML</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-helpful-galaxy-commands">Helpful Galaxy commands</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-contributing-to-ansible-galaxy">Contributing to Ansible Galaxy</a></li>
          </ul>
        </li>
        <li><a href="#chap08.xhtml_leanpub-auto-summary-5">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#chapter-6---playbook-organization---roles-and-includes">Chapter 6 - Playbook Organization - Roles and Includes</a>
      <ul>
        <li><a href="#chap08.xhtml_leanpub-auto-includes">Includes</a>
          <ul>
            <li><a href="#chap08.xhtml_leanpub-auto-dynamic-includes">Dynamic includes</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-handler-includes">Handler includes</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-playbook-includes">Playbook includes</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-complete-includes-example">Complete includes example</a></li>
          </ul>
        </li>
        <li><a href="#chap08.xhtml_leanpub-auto-roles">Roles</a>
          <ul>
            <li><a href="#chap08.xhtml_leanpub-auto-role-scaffolding">Role scaffolding</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-building-your-first-role">Building your first role</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#chap08.xhtml_leanpub-auto-more-flexibility-with-role-vars-and-defaults">More flexibility with role vars and defaults</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-other-role-parts-handlers-files-and-templates">Other role parts: handlers, files, and templates</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-organizing-more-complex-and-cross-platform-roles">Organizing more complex and cross-platform roles</a></li>
          </ul>
        </li>
        <li><a href="#chap08.xhtml_leanpub-auto-ansible-galaxy">Ansible Galaxy</a>
          <ul>
            <li><a href="#chap08.xhtml_leanpub-auto-getting-roles-from-galaxy">Getting roles from Galaxy</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-a-lamp-server-in-eight-lines-of-yaml">A LAMP server in eight lines of YAML</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-a-solr-server-in-eight-lines-of-yaml">A Solr server in eight lines of YAML</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-helpful-galaxy-commands">Helpful Galaxy commands</a></li>
            <li><a href="#chap08.xhtml_leanpub-auto-contributing-to-ansible-galaxy">Contributing to Ansible Galaxy</a></li>
          </ul>
        </li>
        <li><a href="#chap08.xhtml_leanpub-auto-summary-5">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>


<script>
  (function () {
    'use strict'

    const SCROLL_OFFSET_RATIO = 0.33
    const TOC_SELECTOR = '#TableOfContents'
    const ANCHOR_SELECTOR = '.anchor'
    const TOC_LINK_SELECTOR = 'a[href^="#"]'
    const NESTED_LIST_SELECTOR = 'li ul'
    const ACTIVE_CLASS = 'active'
    let isJumpingToAnchor = false

    function getActiveAnchorId(anchors, offsetRatio) {
      const threshold = window.scrollY + window.innerHeight * offsetRatio
      const tocLinks = [...document.querySelectorAll('#TableOfContents a[href^="#"]')]
      const tocIds = new Set(tocLinks.map(link => link.getAttribute('href').substring(1)))

      if (isJumpingToAnchor) {
        for (let i = 0; i < anchors.length; i++) {
          const anchor = anchors[i]
          if (!tocIds.has(anchor.id)) continue
          const top = anchor.getBoundingClientRect().top + window.scrollY
          if (Math.abs(window.scrollY - top) < 100) {
            return anchor.id
          }
        }
      }

      for (let i = anchors.length - 1; i >= 0; i--) {
        const top = anchors[i].getBoundingClientRect().top + window.scrollY
        if (top <= threshold && tocIds.has(anchors[i].id)) {
          return anchors[i].id
        }
      }
      return anchors.find(anchor => tocIds.has(anchor.id))?.id || ''
    }

    function updateTOC({ toc, anchors, links, scrollOffset, collapseInactive }) {
      const activeId = getActiveAnchorId(anchors, scrollOffset)
      if (!activeId) return

      links.forEach(link => {
        const isActive = link.getAttribute('href') === `#${activeId}`
        link.classList.toggle(ACTIVE_CLASS, isActive)

        if (collapseInactive) {
          const ul = link.closest('li')?.querySelector('ul')
          if (ul) ul.style.display = isActive ? '' : 'none'
        }
      })

      if (collapseInactive) {
        const activeLink = toc.querySelector(`a[href="#${CSS.escape(activeId)}"]`)
        let el = activeLink
        while (el && el !== toc) {
          if (el.tagName === 'UL') el.style.display = ''
          if (el.tagName === 'LI') el.querySelector('ul')?.style.setProperty('display', '')
          el = el.parentElement
        }
      }
    }

    function initTOC() {
      const toc = document.querySelector(TOC_SELECTOR)
      if (!toc) return

      const collapseInactive = true
      const anchors = [...document.querySelectorAll(ANCHOR_SELECTOR)]
      const links = [...toc.querySelectorAll(TOC_LINK_SELECTOR)]

      if (collapseInactive) {
        toc.querySelectorAll(NESTED_LIST_SELECTOR).forEach(ul => ul.style.display = 'none')
      }

      links.forEach(link => {
        link.addEventListener('click', () => {
          isJumpingToAnchor = true
        })
      })

      const config = {
        toc,
        anchors,
        links,
        scrollOffset: SCROLL_OFFSET_RATIO,
        collapseInactive
      }

      window.addEventListener('scroll', () => updateTOC(config), { passive: true })
      window.addEventListener('hashchange', () => updateTOC(config), { passive: true })

      updateTOC(config)
    }

    document.readyState === 'loading'
      ? document.addEventListener('DOMContentLoaded', initTOC)
      : initTOC()
  })()
</script>


            
          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        

        <div class="article-content max-w-prose mb-20">
          
<h2 class="relative group">Chapter 6 - Playbook Organization - Roles and Includes
    <div id="chapter-6---playbook-organization---roles-and-includes" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chapter-6---playbook-organization---roles-and-includes" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>So far, we&rsquo;ve used fairly straightforward examples in this book. Most
examples are created for a particular server, and are in one long
playbook.</p>
<p>Ansible is flexible when it comes to organizing tasks in more efficient
ways so you can make playbooks more maintainable, reusable, and
powerful. We&rsquo;ll look at two ways to split up tasks more efficiently
using includes and roles, and we&rsquo;ll explore Ansible Galaxy, a repository
of some community-maintained roles that help configure common packages
and applications.</p>

<h3 class="relative group">Includes
    <div id="chap08xhtml_leanpub-auto-includes" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-includes" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>We&rsquo;ve already seen one of the most basic ways of including other files
in Chapter 4, when <code>vars_files</code> was used to place variables into a
separate <code>vars.yml</code> file instead of inline with the playbook:</p>
<figure class="code">
<div class="highlight">
<pre><code>- hosts: all
<p>vars_files:</p>
<ul>
<li>vars.yml</code></pre></li>
</ul>
</div>
</figure>
<p>Tasks can easily be included in a similar way. In the <code>tasks:</code> section
of your playbook, you can add <code>include</code> directives like so:</p>
<figure class="code">
<div class="highlight">
<pre><code>tasks:
  - include: included-playbook.yml</code></pre>
</div>
</figure>
<p>Just like with variable include files, tasks are formatted in a flat
list in the included file. As an example, the <code>included-playbook.yml</code>
could look like this:</p>
<figure class="code">
<div class="highlight">
<pre><code>---
- name: Add profile info for user.
  copy:
    src: example_profile
    dest: &quot;/home/{{ username }}/.profile&quot;
    owner: &quot;{{ username }}&quot;
    group: &quot;{{ username }}&quot;
    mode: 0744
<ul>
<li>
<p>name: Add private keys for user.
copy:
src: &quot;{{ item.src }}&quot;
dest: &quot;/home/.ssh/{{ item.dest }}&quot;
owner: &quot;{{ username }}&quot;
group: &quot;{{ username }}&quot;
mode: 0600
with_items: ssh_private_keys</p>
</li>
<li>
<p>name: Restart example service.
service: name=example state=restarted</code></pre></p>
</li>
</ul>
</div>
</figure>
<p>In this case, you&rsquo;d probably want to name the file <code>user-config.yml</code>,
since it&rsquo;s used to configure a user account and restart some service.
Now, in this and any other playbook that provisions or configures a
server, if you want to configure a particular user&rsquo;s account, add the
following in your playbook&rsquo;s <code>tasks</code> section:</p>
<figure class="code">
<div class="highlight">
<pre><code>- include: example-app-config.yml</code></pre>
</div>
</figure>
<p>We used <code>{{ username }}</code> and <code>{{ ssh_private_keys }}</code> variables in this
include file instead of hard-coded values so we could make this include
file reusable. You could define the variables in your playbook&rsquo;s inline
variables or an included variables file, but Ansible also lets you pass
variables directly into includes using normal YAML syntax. For example:</p>
<figure class="code">
<div class="highlight">
<pre><code>- { include: user-config.yml, username: johndoe, ssh_private_keys: [] }
- { include: user-config.yml, username: janedoe, ssh_private_keys: [] }</code></pre>
</div>
</figure>
<p>To make the syntax more readable, you can use structured variables, like
so:</p>
<figure class="code">
<div class="highlight">
<pre><code>- include: user-config.yml
  vars:
    username: johndoe
    ssh_private_keys:
      - { src: /path/to/johndoe/key1, dest: id_rsa }
      - { src: /path/to/johndoe/key2, dest: id_rsa_2 }
- include: user-config.yml
  vars:
    username: janedoe
    ssh_private_keys:
      - { src: /path/to/janedoe/key1, dest: id_rsa }
      - { src: /path/to/janedoe/key2, dest: id_rsa_2 }</code></pre>
</div>
</figure>
<p>Include files can even include other files, so you could have something
like the following:</p>
<figure class="code">
<div class="highlight">
<pre><code>tasks:
  - include: user-config.yml</code></pre>
</div>
</figure>
<p><em>inside <code>user-config.yml</code></em></p>
<figure class="code">
<div class="highlight">
<pre><code>- include: ssh-setup.yml</code></pre>
</div>
</figure>

<h4 class="relative group">Dynamic includes
    <div id="chap08xhtml_leanpub-auto-dynamic-includes" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-dynamic-includes" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Until Ansible 2.0.0, includes were processed when your playbook run
started, so you couldn&rsquo;t do things like load a particular include when
some condition was met. Ansible 2.0.0 evaluates includes during playbook
execution, so you can do something like the following:</p>
<figure class="code">
<div class="highlight">
<pre><code># Include extra tasks file, only if it&#39;s present at runtime.
- name: Check if extra_tasks.yml is present.
  stat: path=extras/extra-tasks.yml
  register: extra_tasks_file
  connection: local
<ul>
<li>include: tasks/extra-tasks.yml
when: extra_tasks_file.stat.exists</code></pre></li>
</ul>
</div>
</figure>
<p>If the file <code>tasks/extra-tasks.yml</code> is not present, Ansible skips the
<code>include</code>. You can even use a <code>with_items</code> loop (or any other <code>with_*</code>
loop) with includes. Includes evaluated during playback execution can
make your playbooks much more flexible!</p>

<h4 class="relative group">Handler includes
    <div id="chap08xhtml_leanpub-auto-handler-includes" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-handler-includes" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Handlers can be included just like tasks, within a playbook&rsquo;s <code>handlers</code>
section. For example:</p>
<figure class="code">
<div class="highlight">
<pre><code>handlers:
  - include: included-handlers.yml</code></pre>
</div>
</figure>
<p>This can be helpful in limiting the noise in your main playbook, since
handlers are usually used for things like restarting services or loading
a configuration, and can distract from the playbook&rsquo;s primary purpose.</p>

<h4 class="relative group">Playbook includes
    <div id="chap08xhtml_leanpub-auto-playbook-includes" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-playbook-includes" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Playbooks can even be included in other playbooks, using the same
<code>include</code> syntax in the top level of your playbook. For example, if you
have two playbooks&mdash;one to set up your webservers (<code>web.yml</code>), and one
to set up your database servers (<code>db.yml</code>), you could use the following
playbook to run both at the same time:</p>
<figure class="code">
<div class="highlight">
<pre><code>- hosts: all
  remote_user: root
<p>tasks:
[&hellip;]</p>
<ul>
<li>include: web.yml</li>
<li>include: db.yml</code></pre></li>
</ul>
</div>
</figure>
<p>This way, you can create playbooks to configure all the servers in your
infrastructure, then create a master playbook that includes each of the
individual playbooks. When you want to initialize your infrastructure,
make changes across your entire fleet of servers, or check to make sure
their configuration matches your playbook definitions, you can run one
<code>ansible-playbook</code> command!</p>

<h4 class="relative group">Complete includes example
    <div id="chap08xhtml_leanpub-auto-complete-includes-example" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-complete-includes-example" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>What if I told you we could remake the 137-line Drupal LAMP server
playbook from Chapter 4 in just 21 lines? With includes, it&rsquo;s easy; just
break out each of the sets of tasks into their own include files, and
you&rsquo;ll end up with a main playbook like this:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code> 1 ---
 2 - hosts: all
 3 
 4   vars_files:
 5     - vars.yml
 6 
 7   pre_tasks:
 8     - name: Update apt cache if needed.
 9       apt: update_cache=yes cache_valid_time=3600
10 
11   handlers:
12     - include: handlers/handlers.yml
13 
14   tasks:
15     - include: tasks/common.yml
16     - include: tasks/apache.yml
17     - include: tasks/php.yml
18     - include: tasks/mysql.yml
19     - include: tasks/composer.yml
20     - include: tasks/drush.yml
21     - include: tasks/drupal.yml</code></pre>
</div>
</figure>
<p>All you need to do is create two new folders in the same folder where
you saved the Drupal <code>playbook.yml</code> file, <code>handlers</code> and <code>tasks</code>, then
create files inside for each section of the playbook.</p>
<p>For example, inside <code>handlers/handlers.yml</code>, you&rsquo;d have:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 ---
2 - name: restart apache
3   service: name=apache2 state=restarted</code></pre>
</div>
</figure>
<p>And inside <code>tasks/drush.yml</code>:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code> 1 ---
 2 - name: Check out drush master branch.
 3   git:
 4     repo: https://github.com/drush-ops/drush.git
 5     dest: /opt/drush
 6 
 7 - name: Install Drush dependencies with Composer.&quot;
 8   shell: &gt;
 9     /usr/local/bin/composer install
10     chdir=/opt/drush
11     creates=/opt/drush/vendor/autoload.php
12 
13 - name: Create drush bin symlink.
14   file:
15     src: /opt/drush/drush
16     dest: /usr/local/bin/drush
17     state: link</code></pre>
</div>
</figure>
<p>Separating all the tasks into separate includes files means you&rsquo;ll have
more files to manage for your playbook, but it helps keep the main
playbook more compact. It&rsquo;s easier to see all the installation and
configuration steps the playbook contains, and it separates tasks into
individual, maintainable groupings. Instead of having to browse one
playbook with twenty-three separate tasks, you now maintain eight
included files with two to five tasks, each.</p>
<p>It&rsquo;s much easier to maintain small groupings of related tasks than one
long playbook. However, there&rsquo;s no reason to try to <em>start</em> writing a
playbook with lots of individual includes. Most of the time, it&rsquo;s best
to start with a monolithic playbook while you&rsquo;re working on the setup
and configuration details, then move sets of tasks out to included files
after you start seeing logical groupings.</p>
<p>You can also use tags (demonstrated in the previous chapter) to limit
the playbook run to a certain include file. Using the above example, if
you wanted to add a &lsquo;drush&rsquo; tag to the included drush file (so you could
run <code>ansible-playbook playbook.yml --tags=drush</code> and only run the drush
tasks), you can change line 20 to the following:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>20 - include: tasks/drush.yml tags=drush</code></pre>
</div>
</figure>
<aside class="tip blurb">
<p>You can find the entire example Drupal LAMP server playbook using
include files in this book&rsquo;s code repository at
<a
  href="https://github.com/geerlingguy/ansible-for-devops"
    target="_blank"
  >https://github.com/geerlingguy/ansible-for-devops</a>, in the <code>includes</code>
directory.</p>
</aside>
<aside class="warning blurb">
<p>You can&rsquo;t use variables for task include file names (like you could with
<code>include_vars</code> directives, e.g.
<code>include_vars: &quot;{{ ansible_os_family }}.yml&quot;</code> as a task, or with
<code>vars_files</code>). There&rsquo;s usually a better way than conditional task
includes to accomplish conditional task inclusion using a different
playbook structure, or roles, which we will discuss next.</p>
</aside>

<h3 class="relative group">Roles
    <div id="chap08xhtml_leanpub-auto-roles" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-roles" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Including playbooks inside other playbooks makes your playbook
organization a little more sane, but once you start wrapping up your
entire infrastructure&rsquo;s configuration in playbooks, you might end up
with something resembling Russian nesting dolls.</p>
<p>Wouldn&rsquo;t it be nice if there were a way to take bits of related
configuration, and package them together nicely? Additionally, what if
we could take these packages (often configuring the same thing on many
different servers) and make them flexible so that we can use the same
package throughout our infrastructure, with slightly different settings
on individual servers or groups of servers?</p>
<p>Ansible Roles can do all that and more!</p>
<p>Let&rsquo;s dive into what makes an Ansible role by taking one of the playbook
examples from Chapter 4 and splitting it into a more flexible structure
using roles.</p>

<h4 class="relative group">Role scaffolding
    <div id="chap08xhtml_leanpub-auto-role-scaffolding" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-role-scaffolding" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Instead of requiring you to explicitly include certain files and
playbooks in a role, Ansible automatically includes any <code>main.yml</code> files
inside specific directories that make up the role.</p>
<p>There are only two directories required to make a working Ansible role:</p>
<figure class="code">
<div class="highlight">
<pre><code>role_name/
  meta/
  tasks/</code></pre>
</div>
</figure>
<p>If you create a directory structure like the one shown above, with a
<code>main.yml</code> file in each directory, Ansible will run all the tasks
defined in <code>tasks/main.yml</code> if you call the role from your playbook
using the following syntax:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 ---
2 - hosts: all
3   roles:
4     - role_name</code></pre>
</div>
</figure>
<p>Your roles can live in a couple different places: the default global
Ansible role path (configurable in <code>/etc/ansible/ansible.cfg</code>), or a
<code>roles</code> folder in the same directory as your main playbook file.</p>
<aside class="information blurb">
<p>Another simple way to build the scaffolding for a role is to use the
command: <code>ansible-galaxy init role_name</code>. Running this command creates
an example role in the current working directory, which you can modify
to suit your needs. Using the <code>init</code> command also ensures the role is
structured correctly in case you want to someday contribute the role to
Ansible Galaxy.</p>
</aside>

<h4 class="relative group">Building your first role
    <div id="chap08xhtml_leanpub-auto-building-your-first-role" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-building-your-first-role" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Let&rsquo;s clean up the Node.js server example from Chapter four, and break
out one of the main parts of the configuration&mdash;installing Node.js and
any required npm modules.</p>
<p>Create a <code>roles</code> folder in the same directory as the main <code>playbook.yml</code>
file like, we created in Chapter 4&rsquo;s first example. Inside the <code>roles</code>
folder, create a new folder: <code>nodejs</code> (which will be our role&rsquo;s name).
Create two folders inside the <code>nodejs</code> role directory: <code>meta</code> and
<code>tasks</code>.</p>
<p>Inside the <code>meta</code> folder, add a simple <code>main.yml</code> file with the
following contents:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 ---
2 dependencies: []</code></pre>
</div>
</figure>
<p>The meta information for your role is defined in this file. In basic
examples and simple roles, you just need to list any role dependencies
(other roles that are required to be run before the current role can do
its work). You can add more to this file to describe your role to
Ansible and to Ansible Galaxy, but we&rsquo;ll dive deeper into meta
information later. For now, save the file and head over to the <code>tasks</code>
folder.</p>
<p>Create a <code>main.yml</code> file in this folder, and add the following contents
(basically copying and pasting the configuration from the Chapter 4
example):</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 ---
2 - name: Install Node.js (npm plus all its dependencies).
3   yum: name=npm state=present enablerepo=epel
4 
5 - name: Install forever module (to run our Node.js app).
6   npm: name=forever global=yes state=latest</code></pre>
</div>
</figure>
<p>The Node.js directory structure should now look like the following:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code> 1 nodejs-app/
 2   app/
 3     app.js
 4     package.json
 5   playbook.yml
 6   roles/
 7     nodejs/
 8       meta/
 9         main.yml
10       tasks/
11         main.yml</code></pre>
</div>
</figure>
<p>You now have a complete Ansible role that you can use in your node.js
server configuration playbook. Delete the Node.js app installation lines
from <code>playbook.yml</code>, and reformat the playbook so the other tasks run
first (in a <code>pre_tasks:</code> section instead of <code>tasks:</code>), then the role,
then the rest of the tasks (in the main <code>tasks:</code> section). Something
like:</p>
<figure class="code">
<div class="highlight">
<pre><code>pre_tasks:
  # EPEL/GPG setup, firewall configuration...
<p>roles:</p>
<ul>
<li>nodejs</li>
</ul>
<p>tasks:</p>

<h1 class="relative group">Node.js app deployment tasks&hellip;</code></pre>
    <div id="nodejs-app-deployment-tasks" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#nodejs-app-deployment-tasks" aria-label="Anchor">#</a>
    </span>
    
</h1>
</div>
</figure>
<aside class="information blurb">
<p>You can view the full example of this playbook in the
<a
  href="https://github.com/geerlingguy/ansible-for-devops/blob/master/nodejs-role/"
    target="_blank"
  >ansible-for-devops code
repository</a>.</p>
</aside>
<p>Once you finish reformatting the main playbook, everything will run
exactly the same during an <code>ansible-playbook</code> run, with the exception of
the tasks inside the <code>nodejs</code> role being prefixed with
<code>nodejs | [Task name here]</code>.</p>
<p>This little bit of extra data shown during playbook runs is useful
because it automatically prefixes tasks with the role that provides
them, without you having to add in descriptions as part of the <code>name</code>
values of the tasks.</p>
<p>Our role isn&rsquo;t all that helpful at this point, though, because it still
does only one thing, and it&rsquo;s not really flexible enough to be used on
other servers that might need different Node.js modules to be installed.</p>

<h4 class="relative group">More flexibility with role vars and defaults
    <div id="chap08xhtml_leanpub-auto-more-flexibility-with-role-vars-and-defaults" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-more-flexibility-with-role-vars-and-defaults" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>To make our role more flexible, we can make it use a list of npm modules
instead of a hardcoded value, then allow playbooks using the role to
provide their own module list variable to override our role&rsquo;s default
list.</p>
<p>When running a role&rsquo;s tasks, Ansible picks up variables defined in a
role&rsquo;s <code>vars/main.yml</code> file and <code>defaults/main.yml</code> (I&rsquo;ll get to the
differences between the two later), but will allow your playbooks to
override the defaults or other role-provided variables if you want.</p>
<p>Modify the <code>tasks/main.yml</code> file to use a list variable and iterate
through the list to install as many packages as your playbook wants:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 ---
2 - name: Install Node.js (npm plus all its dependencies).
3   yum: name=npm state=present enablerepo=epel
4 
5 - name: Install npm modules required by our app.
6   npm: name={{ item }} global=yes state=latest
7   with_items: node_npm_modules</code></pre>
</div>
</figure>
<p>Let&rsquo;s provide a sane default for the new <code>node_npm_modules</code> variable in
<code>defaults/main.yml</code>:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 ---
2 node_npm_modules:
3   - forever</code></pre>
</div>
</figure>
<p>Now, if you run the playbook as-is, it will still do the exact same
thing&mdash;install the <code>forever</code> module. But since the role is more
flexible, we could create a new playbook like our first, but add a
variable (either in a <code>vars</code> section or in an included file via
<code>vars_files</code>) to override the default, like so:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 node_npm_modules:
2   - forever
3   - async
4   - request</code></pre>
</div>
</figure>
<p>When you run the playbook with this custom variable (we didn&rsquo;t change
<em>anything</em> with our <code>nodejs</code> role), all three of the above npm modules
will be installed.</p>
<p>Hopefully you&rsquo;re beginning to see how this can be powerful!</p>
<p>Imagine if you had a playbook structure like:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 ---
2 - hosts: appservers
3   roles:
4     - yum-repo-setup
5     - firewall
6     - nodejs
7     - app-deploy</code></pre>
</div>
</figure>
<p>Each one of the roles lives in its own isolated world, and can be shared
with other servers and groups of servers in your infrastructure.</p>
<ul>
<li>A <code>yum-repo-setup</code> role could enable certain repositories and import
their GPG keys.</li>
<li>A <code>firewall</code> role could have per-server or per-inventory-group options
for ports and services to allow or deny.</li>
<li>An <code>app-deploy</code> role could deploy your app to a directory
(configurable per-server) and set certain app options per-server or
per-group.</li>
</ul>
<p>These things are easy to manage when you have small bits of
functionality separated into different roles. Instead of managing 100+
lines of playbook tasks, and manually prefixing every <code>name:</code> with
something like &ldquo;Common |&rdquo; or &ldquo;App Deploy |&rdquo;, you now manage a few
roles with 10-20 lines of YAML each.</p>
<p>On top of that, when you&rsquo;re building your main playbooks, they can be
extremely simple (like the above example), enabling you to see
<em>everything</em> being configured and deployed on a particular server
without scrolling through dozens of included playbook files and hundreds
of tasks.</p>
<aside class="tip blurb">
<p><strong>Variable precedence</strong>: Note that Ansible handles variables placed in
included files in <code>defaults</code> with less precedence than those placed in
<code>vars</code>. If you have certain variables you need to allow hosts/playbooks
to easily override, you should probably put them into <code>defaults</code>. If
they are common variables that should almost always be the values
defined in your role, put them into <code>vars</code>. For more on variable
precedence, see the aptly-named &ldquo;Variable Precedence&rdquo; section in the
previous chapter.</p>
</aside>

<h4 class="relative group">Other role parts: handlers, files, and templates
    <div id="chap08xhtml_leanpub-auto-other-role-parts-handlers-files-and-templates" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-other-role-parts-handlers-files-and-templates" aria-label="Anchor">#</a>
    </span>
    
</h4>

<h5 class="relative group">Handlers
    <div id="chap08xhtml_leanpub-auto-handlers-1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-handlers-1" aria-label="Anchor">#</a>
    </span>
    
</h5>
<p>In one of the prior examples, we introduced handlers&mdash;tasks that could
be called via the <code>notify</code> option after any playbook task resulted in a
change&mdash;and an example handler for restarting Apache was given:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 handlers:
2   - name: restart apache
3     service: name=apache2 state=restarted</code></pre>
</div>
</figure>
<p>In Ansible roles, handlers are first-class citizens, alongside tasks,
variables, and other configuration. You can store handlers directly
inside a <code>main.yml</code> file inside a role&rsquo;s <code>handlers</code> directory. So if we
had a role for Apache configuration, our <code>handlers/main.yml</code> file could
look like this:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 ---
2 - name: restart apache
3   command: service apache2 restart</code></pre>
</div>
</figure>
<p>You can call handlers defined in a role&rsquo;s handlers folder just like
those included directly in your playbooks (e.g.
<code>notify: restart apache</code>).</p>

<h5 class="relative group">Files and Templates
    <div id="chap08xhtml_leanpub-auto-files-and-templates" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-files-and-templates" aria-label="Anchor">#</a>
    </span>
    
</h5>
<p>For the following examples, let&rsquo;s assume our role is structured with
files and templates inside <code>files</code> and <code>templates</code> directories,
respectively:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code> 1 roles/
 2   example/
 3     files/
 4       example.conf
 5     meta/
 6       main.yml
 7     templates/
 8       example.xml.j2
 9     tasks/
10       main.yml</code></pre>
</div>
</figure>
<p>when copying a file directly to the server, add the filename or the full
path from within a role&rsquo;s <code>files</code> directory, like so:</p>
<figure class="code">
<div class="highlight">
<pre><code>- name: Copy configuration file to server directly.
  copy: &gt;
    src=example.conf
    dest=/etc/myapp/example.conf
    mode=644</code></pre>
</div>
</figure>
<p>Similarly, when specifying a template, add the filename or the full path
from within a role&rsquo;s <code>templates</code> directory, like so:</p>
<figure class="code">
<div class="highlight">
<pre><code>- name: Copy configuration file to server using a template.
  template: &gt;
    src=example.xml.j2
    dest=/etc/myapp/example.xml
    mode=644</code></pre>
</div>
</figure>
<p>The <code>copy</code> module copies files from within the module&rsquo;s <code>files</code> folder,
and the <code>template</code> module runs given template files through the Jinja2
templating engine, merging in any variables available during your
playbook run before copying the file to the server.</p>

<h4 class="relative group">Organizing more complex and cross-platform roles
    <div id="chap08xhtml_leanpub-auto-organizing-more-complex-and-cross-platform-roles" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-organizing-more-complex-and-cross-platform-roles" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>For simple package installation and configuration roles, you can get by
with placing all tasks, variables, and handlers directly in the
respective <code>main.yml</code> file Ansible automatically loads. But you can also
<em>include</em> other files from within a role&rsquo;s <code>main.yml</code> files if needed.</p>
<p>As a rule of thumb, I keep my playbook and role task files under 100
lines of YAML if at all possible. It&rsquo;s easier to keep the entire set of
tasks in my head while making changes or fixing bugs. If I start nearing
that limit, I usually split the tasks into logical groupings, and
include files from the <code>main.yml</code> file.</p>
<p>Let&rsquo;s take a look at the way my <code>geerlingguy.apache</code> role is set up
(it&rsquo;s <a
  href="https://galaxy.ansible.com/list#/roles/428"
    target="_blank"
  >available on Ansible
Galaxy</a> and can be
downloaded to your roles directory with the command
<code>ansible-galaxy install geerlingguy.apache</code>; we&rsquo;ll discuss Ansible
Galaxy itself later).</p>
<p>Initially, the role&rsquo;s main <code>tasks/main.yml</code> file looked something like
the following (generally speaking):</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 - name: Ensure Apache is installed (via apt).
2 
3 - name: Configure Apache with lineinfile.
4 
5 - name: Enable Apache modules.</code></pre>
</div>
</figure>
<p>Soon after creating the role, though, I wanted to make the role work
with both Debian and RedHat hosts. I could&rsquo;ve added two sets of tasks in
the <code>main.yml</code> file, resulting in twice the number of tasks and a bunch
of extra <code>when</code> statements:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code> 1 - name: Ensure Apache is installed (via apt).
 2   when: ansible_os_family == &#39;Debian&#39;
 3 
 4 - name: Ensure Apache is installed (via yum).
 5   when: ansible_os_family == &#39;RedHat&#39;
 6 
 7 - name: Configure Apache with lineinfile (Debian).
 8   when: ansible_os_family == &#39;Debian&#39;
 9 
10 - name: Configure Apache with lineinfile (Redhat).
11   when: ansible_os_family == &#39;RedHat&#39;
12 
13 - name: Enable Apache modules (Debian).
14   when: ansible_os_family == &#39;Debian&#39;
15 
16 - name: Other OS-agnostic tasks...</code></pre>
</div>
</figure>
<p>If I had gone this route, and continued with the rest of the playbook
tasks in one file, I would&rsquo;ve quickly surpassed my informal 100-line
limit. So I chose to use includes in my main tasks file:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code> 1 - name: Include OS-specific variables.
 2   include_vars: &quot;{{ ansible_os_family }}.yml&quot;
 3 
 4 - include: setup-RedHat.yml
 5   when: ansible_os_family == &#39;RedHat&#39;
 6 
 7 - include: setup-Debian.yml
 8   when: ansible_os_family == &#39;Debian&#39;
 9 
10 - name: Other OS-agnostic tasks...</code></pre>
</div>
</figure>
<p>Two important things to notice about this style of distribution-specific
inclusion:</p>
<ol>
<li>When including vars files (with <code>include_vars</code>), you can actually
<em>use variables in the name of the file</em>. This is handy in many
situtations, and here we&rsquo;re including a vars file in the format
<code>distribution_name.yml</code>. For our purposes, since the role will be
used on Debian and RedHat-based hosts, we can create <code>Debian.yml</code>
and <code>RedHat.yml</code> files in our role&rsquo;s <code>defaults</code> and <code>vars</code> folders,
and put distribution-specific variables there.</li>
<li>When including playbook files (with <code>include</code>), you can&rsquo;t use
variables in the name of the file, but you can do the next best
thing: include the files by name explicitly, and use a condition to
tell Ansible whether to run the tasks inside (the <code>when</code> condition
will be applied to every task inside the included playbook).</li>
</ol>
<p>After setting things up this way, I put RedHat and CentOS-specific tasks
(like <code>yum</code> tasks) into <code>tasks/setup-RedHat.yml</code>, and Debian and
Ubuntu-specific tasks (like <code>apt</code> tasks) into <code>tasks/setup-Debian.yml</code>.
There are other ways of making roles work cross-platform, but using
distribution-specific variables files and included playbooks is one of
the simplest.</p>
<p>Now this Apache role can be used across different distributions, and
with clever usage of variables in tasks and in configuration templates,
it can be used in a wide variety of infrastructure that needs Apache
installed.</p>

<h3 class="relative group">Ansible Galaxy
    <div id="chap08xhtml_leanpub-auto-ansible-galaxy" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-ansible-galaxy" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Ansible roles are powerful and flexible; they allow you to encapsulate
sets of configuration and deployable units of playbooks, variables,
templates, and other files, so you can easily reuse them across
different servers.</p>
<p>It&rsquo;s annoying to have to start from scratch every time, though; wouldn&rsquo;t
it be better if people could share roles for commonly-installed
applications and services?</p>
<p>Enter <a
  href="https://galaxy.ansible.com/"
    target="_blank"
  >Ansible Galaxy</a>.</p>
<p>Ansible Galaxy, or just &lsquo;Galaxy&rsquo;, is a repository of
community-contributed roles for common Ansible content. There are
already hundreds of roles available which can configure and deploy
common applications, and they&rsquo;re all available through the
<code>ansible-galaxy</code> command, introduced in Ansible 1.4.2.</p>
<p>Galaxy offers the ability to add, download, and rate roles. With an
account, you can contribute your own roles or rate others&rsquo; roles (though
you don&rsquo;t need an account to use roles).</p>

<h4 class="relative group">Getting roles from Galaxy
    <div id="chap08xhtml_leanpub-auto-getting-roles-from-galaxy" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-getting-roles-from-galaxy" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>One of the primary functions of the <code>ansible-galaxy</code> command is
retrieving roles from Galaxy. Roles must be downloaded before they can
be used in playbooks.</p>
<p>Remember the basic LAMP (Linux, Apache, MySQL and PHP) server we
installed earlier in the book? Let&rsquo;s create it again, but this time,
using a few roles from Galaxy:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible-galaxy install geerlingguy.apache geerlingguy.mysql geerlingguy.php</code></pre>
</div>
</figure>
<aside class="tip blurb">
<p>The latest version or a role will be downloaded if no version is
specified. To specify a version, add the version after the role name,
for example: <code>$ ansible-galaxy install geerlingguy.apache,1.0.0</code>.</p>
</aside>
<aside class="information blurb">
<p>Ansible Galaxy is still evolving rapidly, and has seen many
improvements. There are a few areas where Galaxy could use some
improvement (like browsing for roles by Operating System in the online
interface, or automatically downloading roles that are included in
playbooks), but most of these little bugs or rough spots will be fixed
in time. Please check Ansible Galaxy&rsquo;s
<a
  href="https://galaxy.ansible.com/intro"
    target="_blank"
  >About</a> page and stay tuned to
Ansible&rsquo;s blog for the latest updates.</p>
</aside>

<h5 class="relative group">Using role requirements files to manage dependencies
    <div id="chap08xhtml_leanpub-auto-using-role-requirements-files-to-manage-dependencies" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-using-role-requirements-files-to-manage-dependencies" aria-label="Anchor">#</a>
    </span>
    
</h5>
<p>If your infrastructure configuration requires five, ten, fifteen or more
Ansible roles, installing them all via <code>ansible-galaxy install</code> commands
can be exhausting. Additionally, if you host roles internally (e.g. via
an internal Git or Mercurial repository), you can&rsquo;t install the roles
through Ansible Galaxy. You can, however, pass the <code>ansible-galaxy</code>
command a &ldquo;requirements&rdquo; file with the <code>-r</code> option to automatically
download all dependencies.</p>
<p>Ansible allows a simple <code>.txt</code> format that is very basic (though this
format is deprecated and may be removed), but you should generally use
the more standard and expressive YAML format, which allows you to
install roles from Ansible Galaxy, GitHub, an HTTP download, BitBucket,
or your own repository. It also allows you to specify the path into
which the roles should be downloaded. An example <code>requirements.yml</code> file
looks like this:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code> 1 ---
 2 # From Ansible Galaxy, latest version.
 3 - src: geerlingguy.firewall
 4 
 5 # From Ansible Galaxy, specifying the version.
 6 - src: geerlingguy.php
 7   version: 1.4.1
 8 
 9 # From GitHub, into a particular path, with a custom name and version.
10 - src: https://github.com/geerlingguy/ansible-role-passenger
11   path: /etc/ansible/roles/
12   name: passenger
13   version: 1.0.2
14 
15 # From a web server, with a custom name.
16 - src: https://www.example.com/ansible/roles/my-role-name.tar.gz
17   name: my-role</code></pre>
</div>
</figure>
<p>To install the roles defined in a requirements file, use the command
<code>ansible-galaxy install -r requirements.yml</code>. For more documentation on
Ansible requirements files, see the official documentation: <a
  href="http://docs.ansible.com/ansible/galaxy.html#advanced-control-over-role-requirements-files"
    target="_blank"
  >Advanced
Control over Role Requirements
Files</a>.</p>

<h4 class="relative group">A LAMP server in eight lines of YAML
    <div id="chap08xhtml_leanpub-auto-a-lamp-server-in-eight-lines-of-yaml" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-a-lamp-server-in-eight-lines-of-yaml" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>With the Apache, MySQL, and PHP roles installed, we can quickly create a
LAMP server. This example assumes you already have a CentOS-based linux
VM or server booted and can connect to it or run Ansible as a
provisioner via Vagrant on it, and that you&rsquo;ve run the
<code>ansible-galaxy install</code> command above to download the required roles.</p>
<p>First, create an Ansible playbook named <code>lamp.yml</code> with the following
contents:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 ---
2 - hosts: all
3   sudo: true
4 
5   roles:
6     - geerlingguy.mysql
7     - geerlingguy.apache
8     - geerlingguy.php</code></pre>
</div>
</figure>
<p>Now, run the playbook against a host:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible-playbook -i path/to/custom-inventory lamp.yml</code></pre>
</div>
</figure>
<p>After a few minutes, an entire LAMP server should be set up and running.
If you add in a few variables, you can configure virtualhosts, PHP
configuration options, MySQL server settings, etc.</p>
<p>We&rsquo;ve effectively reduced about thirty lines of YAML (from previous
examples dealing with LAMP or LAMP-like servers) down to three.
Obviously, the roles have extra code in them, but the power here is in
abstraction. Since most companies have many servers using similar
software, but with slightly different configurations, having
centralized, flexible roles saves a lot of repetition.</p>
<p>You could think of Galaxy roles as glorified packages; they not only
install software, but they configure it <em>exactly</em> how you want it, every
time, with minimal adjustment. Additionally, many of these roles work
across different flavors of Linux and UNIX, so you have better
configuration portability!</p>

<h4 class="relative group">A Solr server in eight lines of YAML
    <div id="chap08xhtml_leanpub-auto-a-solr-server-in-eight-lines-of-yaml" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-a-solr-server-in-eight-lines-of-yaml" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Let&rsquo;s grab a few more roles and build an Apache Solr search server,
which requires Java and Apache Tomcat to be installed and configured.</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible-galaxy install geerlingguy.java geerlingguy.tomcat6 geerlingguy.solr</code></pre>
</div>
</figure>
<p>Then create a playbook named <code>solr.yml</code> with the following contents:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code>1 ---
2 - hosts: all
3   sudo: yes
4 
5   roles:
6     - geerlingguy.java
7     - geerlingguy.tomcat6
8     - geerlingguy.solr</code></pre>
</div>
</figure>
<p>Now we have a fully-functional Solr server, and we could add some
variables to configure it exactly how we want, by using a non-default
port, or changing the memory allocation for Tomcat6.</p>
<p>I could&rsquo;ve also left out the <code>java</code> and <code>tomcat6</code> roles, since they&rsquo;ll
be automatically picked up during installation of the <code>geerlingguy.solr</code>
role (they&rsquo;re listed in the <code>solr</code> role&rsquo;s dependencies).</p>
<p>A role&rsquo;s page on the Ansible Galaxy website highlights available
variables for setting things like what version of Solr to install, where
to install it, etc. For an example, view the <a
  href="https://galaxy.ansible.com/list#/roles/445"
    target="_blank"
  >geerlingguy.solr Galaxy
page</a>.</p>
<p>You can build a wide variety of servers with minimal effort with
existing contributed roles on Galaxy. Instead of having to maintain
lengthy playbooks and roles unique to each server, Galaxy lets you build
a list of the required roles, and a few variables that set up the
servers with the proper versions and paths. Configuration management
with Ansible Galaxy becomes <em>true</em> configuration management&mdash;you get to
spend more time managing your server&rsquo;s configuration, and less time on
packaging and building individual services!</p>

<h4 class="relative group">Helpful Galaxy commands
    <div id="chap08xhtml_leanpub-auto-helpful-galaxy-commands" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-helpful-galaxy-commands" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Some other helpful <code>ansible-galaxy</code> commands you might use from time to
time:</p>
<ul>
<li><code>ansible-galaxy list</code> displays a list of installed roles, with version
numbers</li>
<li><code>ansible-galaxy remove [role]</code> removes an installed role</li>
<li><code>ansible-galaxy init</code> can be used to create a role template suitable
for submission to Ansible Galaxy</li>
</ul>
<p>You can configure the default path where Ansible roles will be
downloaded by editing your <code>ansible.cfg</code> configuration file (normally
located in <code>/etc/ansible/ansible.cfg</code>), and setting a <code>roles_path</code> in
the <code>[defaults]</code> section.</p>

<h4 class="relative group">Contributing to Ansible Galaxy
    <div id="chap08xhtml_leanpub-auto-contributing-to-ansible-galaxy" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-contributing-to-ansible-galaxy" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>If you&rsquo;ve been working on some useful Ansible roles, and you&rsquo;d like to
share them with others, all you need to do is make sure they follow
Ansible Galaxy&rsquo;s basic template (especially within the <code>meta/main.yml</code>
and <code>README.md</code> files). To get started, use <code>ansible-galaxy init</code> to
generate a basic Galaxy template, and make your own role match the
Galaxy template&rsquo;s structure.</p>
<p>Then push your role up to a new project on GitHub (I usually name my
Galaxy roles like <code>ansible-role-[rolename]</code>, so I can easily see them
when browsing my repos on GitHub), and add a new role while logged into
galaxy.ansible.com.</p>

<h3 class="relative group">Summary
    <div id="chap08xhtml_leanpub-auto-summary-5" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#chap08xhtml_leanpub-auto-summary-5" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Using includes and Ansible roles organizes Playbooks and makes them
maintainable. This chapter introduced different ways of using <code>include</code>,
the power and flexible structure of roles, and how you can utilize
Ansible Galaxy, the community repository of configurable Ansible roles
that do just about anything.</p>
<figure class="code">
<div class="highlight">
<pre><code> _________________________________________
/ When the only tool you own is a hammer, \
| every problem begins to resemble a      |
\ nail. (Abraham Maslow)                  /
 -----------------------------------------
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||</code></pre>
</div>
</figure>
:::
<p>[]{#chap09.xhtml}</p>
<p>::: {}</p>

          
          
          
        </div>
        
        

        

        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js"
          integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="
          data-oid="views_tech/ansible/Ansible4Devops/Chapter 6 - Playbook Organization - Roles and Includes.md"
          data-oid-likes="likes_tech/ansible/Ansible4Devops/Chapter 6 - Playbook Organization - Roles and Includes.md"></script>
      
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      

      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
      
      
        
      
      
      
      
      <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 overflow-x-auto py-2">
        <ul class="flex list-none flex-row">
          
            <li class=" flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 me-4">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href=""
                title="">
                
                
              </a>
            </li>
          
        </ul>
      </nav>
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2025
          David Thomas
      </p>
    

    
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="http://localhost:1313/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
