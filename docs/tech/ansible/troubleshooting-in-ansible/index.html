<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="false"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title>Using Modules for Troubleshooting and Testing &middot; </title>
    <meta name="title" content="Using Modules for Troubleshooting and Testing &middot; ">
  

  
  
    <meta name="description" content="Using Modules for Troubleshooting and Testing">
  
  
  
  
  <link rel="canonical" href="http://localhost:1313/tech/ansible/troubleshooting-in-ansible/">
  

  
  
    <meta name="author" content="David Thomas">
  
  

  
  <meta property="og:url" content="http://localhost:1313/tech/ansible/troubleshooting-in-ansible/">
  <meta property="og:title" content="Using Modules for Troubleshooting and Testing">
  <meta property="og:description" content="Using Modules for Troubleshooting and Testing">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="tech">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Using Modules for Troubleshooting and Testing">
  <meta name="twitter:description" content="Using Modules for Troubleshooting and Testing">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
  
  
  
  

  

  
  
  
  
  
  
  
    
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.278a55d3e0b39215730b0c642c7c22cc020054272d3850d92c957cddf6209cf18e0ed01f082db397c8c048c30e727b44ca408c350384ca92d5f37c62d008cbd8.css"
    integrity="sha512-J4pV0&#43;CzkhVzCwxkLHwizAIAVCctOFDZLJV83fYgnPGODtAfCC2zl8jASMMOcntEykCMNQOEypLV83xi0AjL2A==">

  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
  
    
    <script src="/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js" integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7&#43;kfJ6kKCJxQGC&#43;8wm&#43;Bz9JucDjDTGNew=="></script>
  

  
  
  
    
  
  
    
  
  
    
  
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js"
      integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP&#43;pSqMXxm6JPOUeAg=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>


























  

  

  

  

  





  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "",
    "name": "Using Modules for Troubleshooting and Testing",
    "headline": "Using Modules for Troubleshooting and Testing",
    "description": "Using Modules for Troubleshooting and Testing",
    "abstract": "\u003ch3 class=\u0022relative group\u0022\u003eUsing Modules for Troubleshooting and Testing\n    \u003cdiv id=\u0022using-modules-for-troubleshooting-and-testing\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#using-modules-for-troubleshooting-and-testing\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h3\u003e\n\u003cp\u003eModules used for troubleshooting\u003c\/p\u003e\n\u003cp\u003edebug - Write debug information. Useful for checking variable values\nuri - Test answer coming from any URL. Useful for API calls\nfail - Uses when conditional to determine when a module should be considered failing\nscript - Allows you to execute a shell script on the managed host\nstat - Gathers status information about files\nassert - tests whether the expected result is present and otherwise fails\u003c\/p\u003e",
    "inLanguage": "en",
    "url" : "http://localhost:1313/tech/ansible/troubleshooting-in-ansible/",
    "author" : {
      "@type": "Person",
      "name": "David Thomas"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "4780"
  }]
  </script>



  
  

  
  

  
  

  
  
    
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
      <script>

    const firebaseConfig = {
      apiKey: "AIzaSyApsKLCbGb5fkkrzxABOtl3-OUuBcRPVsc",
      authDomain: "davidwrites-89dd7.firebaseapp.com",
      projectId: "davidwrites-89dd7",
      storageBucket: "davidwrites-89dd7.firebasestorage.app",
      messagingSenderId: "433139099634",
      appId: "1:433139099634:web:c14275555bd7171e6c6d6b",
      measurementId: "G-XX5507B82W"
    };

        var app = firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();
        var auth = firebase.auth();

      </script>
    
  

  
  
</head>







  
    
  







  
    
  






  
  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      













<div
  class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0">
  
  
    
    
      <div>
        <a href="/" class="flex">
          <span class="sr-only"></span>
          
            <img
              src="/img/logo.png"
              width="200"
              height="37"
              class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom"
              alt="">
          
        </a>
      </div>
    

  <div class="flex flex-1 items-center justify-between">
    <nav class="flex space-x-3">
      
    </nav>
    
  <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">
    
      
        
  <a
  href="/tech/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Tech"
  title="">
  
  
    <p class="text-base font-medium">
      Tech
    </p>
  
</a>



      
        
  <a
  href="/notes/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Notes"
  title="Book Notes &amp; Reviews">
  
  
    <p class="text-base font-medium">
      Notes
    </p>
  
</a>



      
        
  <a
  href="/articles/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Articles"
  title="Articles">
  
  
    <p class="text-base font-medium">
      Articles
    </p>
  
</a>



      
        
  <a
  href="/now/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Now"
  title="Now">
  
  
    <p class="text-base font-medium">
      Now
    </p>
  
</a>



      
        
  <a
  href=""
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  
  title="">
  
  
</a>



      
    

    

    

    
      <button
        id="search-button"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
  </nav>

    
  <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">
    <span></span>

    

    

    
      <button
        id="search-button-mobile"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
  </div>

  </div>
  
  <div class="-my-2 md:hidden">
    <div id="menu-button" class="block">
      
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]">
          <ul
            class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl">
            <li id="menu-close-button">
              <span
                class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">
                <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
              </span>
            </li>

            
              
  <li class="mt-1">
  <a
    href="/tech/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Tech"
    title="">
    
    
      <p class="text-bg font-bg">
        Tech
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/notes/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Notes"
    title="Book Notes &amp; Reviews">
    
    
      <p class="text-bg font-bg">
        Notes
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/articles/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Articles"
    title="Articles">
    
    
      <p class="text-bg font-bg">
        Articles
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/now/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Now"
    title="Now">
    
    
      <p class="text-bg font-bg">
        Now
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href=""
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    
    title="">
    
    
  </a>
</li>



            

          </ul>
          
        </div>
      
    </div>
  </div>

</div>




  <script>
    (function () {
      var $mainmenu = $(".main-menu");
      var path = window.location.pathname;
      $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
        $(e).children("p").addClass("active");
      });
    })();
  </script>


    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Using Modules for Troubleshooting and Testing
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  

  

  

  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    

    
    
  </div>

  

  
  

  
  



      </div>
      
        
  
  
  
  
  
  

  

  

  

  

      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      
        <div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
          <div class="toc ps-5 print:hidden lg:sticky lg:top-10">
            
              <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#using-modules-for-troubleshooting-and-testing">Using Modules for Troubleshooting and Testing</a>
          <ul>
            <li><a href="#using-the-debug-module">Using the Debug Module</a></li>
            <li><a href="#using-the-uri-module">Using the uri Module</a></li>
            <li><a href="#using-the-stat-module">Using the stat Module</a></li>
            <li><a href="#using-the-assert-module">Using the assert Module</a></li>
          </ul>
        </li>
        <li><a href="#troubleshooting-common-scenarios">Troubleshooting Common Scenarios</a>
          <ul>
            <li><a href="#analyzing-connectivity-issues">Analyzing Connectivity Issues</a></li>
            <li><a href="#analyzing-authentication-issues">Analyzing Authentication Issues</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#using-check-mode">Using Check Mode</a></li>
            <li><a href="#understanding-output">Understanding Output</a></li>
            <li><a href="#optimizing-command-output-error-formatting">Optimizing Command Output Error Formatting</a></li>
            <li><a href="#logging-to-files">Logging to Files</a></li>
            <li><a href="#running-task-by-task">Running Task by Task</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#using-modules-for-troubleshooting-and-testing">Using Modules for Troubleshooting and Testing</a>
          <ul>
            <li><a href="#using-the-debug-module">Using the Debug Module</a></li>
            <li><a href="#using-the-uri-module">Using the uri Module</a></li>
            <li><a href="#using-the-stat-module">Using the stat Module</a></li>
            <li><a href="#using-the-assert-module">Using the assert Module</a></li>
          </ul>
        </li>
        <li><a href="#troubleshooting-common-scenarios">Troubleshooting Common Scenarios</a>
          <ul>
            <li><a href="#analyzing-connectivity-issues">Analyzing Connectivity Issues</a></li>
            <li><a href="#analyzing-authentication-issues">Analyzing Authentication Issues</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#using-check-mode">Using Check Mode</a></li>
            <li><a href="#understanding-output">Understanding Output</a></li>
            <li><a href="#optimizing-command-output-error-formatting">Optimizing Command Output Error Formatting</a></li>
            <li><a href="#logging-to-files">Logging to Files</a></li>
            <li><a href="#running-task-by-task">Running Task by Task</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>


<script>
  (function () {
    'use strict'

    const SCROLL_OFFSET_RATIO = 0.33
    const TOC_SELECTOR = '#TableOfContents'
    const ANCHOR_SELECTOR = '.anchor'
    const TOC_LINK_SELECTOR = 'a[href^="#"]'
    const NESTED_LIST_SELECTOR = 'li ul'
    const ACTIVE_CLASS = 'active'
    let isJumpingToAnchor = false

    function getActiveAnchorId(anchors, offsetRatio) {
      const threshold = window.scrollY + window.innerHeight * offsetRatio
      const tocLinks = [...document.querySelectorAll('#TableOfContents a[href^="#"]')]
      const tocIds = new Set(tocLinks.map(link => link.getAttribute('href').substring(1)))

      if (isJumpingToAnchor) {
        for (let i = 0; i < anchors.length; i++) {
          const anchor = anchors[i]
          if (!tocIds.has(anchor.id)) continue
          const top = anchor.getBoundingClientRect().top + window.scrollY
          if (Math.abs(window.scrollY - top) < 100) {
            return anchor.id
          }
        }
      }

      for (let i = anchors.length - 1; i >= 0; i--) {
        const top = anchors[i].getBoundingClientRect().top + window.scrollY
        if (top <= threshold && tocIds.has(anchors[i].id)) {
          return anchors[i].id
        }
      }
      return anchors.find(anchor => tocIds.has(anchor.id))?.id || ''
    }

    function updateTOC({ toc, anchors, links, scrollOffset, collapseInactive }) {
      const activeId = getActiveAnchorId(anchors, scrollOffset)
      if (!activeId) return

      links.forEach(link => {
        const isActive = link.getAttribute('href') === `#${activeId}`
        link.classList.toggle(ACTIVE_CLASS, isActive)

        if (collapseInactive) {
          const ul = link.closest('li')?.querySelector('ul')
          if (ul) ul.style.display = isActive ? '' : 'none'
        }
      })

      if (collapseInactive) {
        const activeLink = toc.querySelector(`a[href="#${CSS.escape(activeId)}"]`)
        let el = activeLink
        while (el && el !== toc) {
          if (el.tagName === 'UL') el.style.display = ''
          if (el.tagName === 'LI') el.querySelector('ul')?.style.setProperty('display', '')
          el = el.parentElement
        }
      }
    }

    function initTOC() {
      const toc = document.querySelector(TOC_SELECTOR)
      if (!toc) return

      const collapseInactive = true
      const anchors = [...document.querySelectorAll(ANCHOR_SELECTOR)]
      const links = [...toc.querySelectorAll(TOC_LINK_SELECTOR)]

      if (collapseInactive) {
        toc.querySelectorAll(NESTED_LIST_SELECTOR).forEach(ul => ul.style.display = 'none')
      }

      links.forEach(link => {
        link.addEventListener('click', () => {
          isJumpingToAnchor = true
        })
      })

      const config = {
        toc,
        anchors,
        links,
        scrollOffset: SCROLL_OFFSET_RATIO,
        collapseInactive
      }

      window.addEventListener('scroll', () => updateTOC(config), { passive: true })
      window.addEventListener('hashchange', () => updateTOC(config), { passive: true })

      updateTOC(config)
    }

    document.readyState === 'loading'
      ? document.addEventListener('DOMContentLoaded', initTOC)
      : initTOC()
  })()
</script>


            
          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        

        <div class="article-content max-w-prose mb-20">
          
<h3 class="relative group">Using Modules for Troubleshooting and Testing
    <div id="using-modules-for-troubleshooting-and-testing" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#using-modules-for-troubleshooting-and-testing" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Modules used for troubleshooting</p>
<p>debug - Write debug information. Useful for checking variable values
uri - Test answer coming from any URL. Useful for API calls
fail - Uses when conditional to determine when a module should be considered failing
script - Allows you to execute a shell script on the managed host
stat - Gathers status information about files
assert - tests whether the expected result is present and otherwise fails</p>

<h4 class="relative group">Using the Debug Module
    <div id="using-the-debug-module" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#using-the-debug-module" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>The debug module is useful to visualize what is happening at a certain
point in a playbook. It works with two arguments: the <strong>msg</strong> argument
can be used to print a message, and the <strong>var</strong> argument can be used to
print the value of a variable. Notice that when you use the <strong>var</strong>
argument, the variable does not have to be referred to using the usual
<strong>{{ varname }}</strong> structure, just use <strong>varname</strong> instead. If variables
are used in the <strong>msg</strong> argument, they must be referred to the normal
way, using the <strong>{{ varname }}</strong> syntax.</p>
<p>Because you have already seen the debug module in action in numerous
examples in Chapters 6, 7, and 8 of this book, no new examples are
included here.</p>
<p><strong>debug:</strong>
Prints statements during execution. Used for debugging variables or expressions without stopping a playbook.</p>
<p>Print out the value of the ansible_facts variable:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">debug</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">var</span><span class="p">:</span><span class="w"> </span><span class="l">ansible_facts</span><span class="w">
</span></span></span></code></pre></div>
<h4 class="relative group">Using the uri Module
    <div id="using-the-uri-module" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#using-the-uri-module" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p><strong>uri:</strong>
Interacts with basic http and https web services. (Verify connectivity to a web server
+9)</p>
<p>Test httpd accessibility:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">uri</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">http://ansible1</span><span class="w">
</span></span></span></code></pre></div><p>Show result of the command while running the playbook:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">uri</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">http://ansible1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">return_content</span><span class="p">:</span><span class="w"> </span><span class="kc">yes</span><span class="w">
</span></span></span></code></pre></div><p>Show the status code that signifies the success of the request:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">uri</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">http://ansible1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">status_code</span><span class="p">:</span><span class="w"> </span><span class="m">200</span><span class="w">
</span></span></span></code></pre></div><p>The best way to learn how to work with these modules is to look at some
examples. <a
  href="#ch11.xhtml#list11_7">Listing 11-7</a> shows an example where
the uri module is used.</p>
<p><strong>Listing 11-7</strong> Using the uri Module</p>
<p>::: pre_1
&mdash;
- name: test webserver access
hosts: localhost
become: no
tasks:
- name: connect to the web server
uri:
url: <a
  href="http://ansible2.example.com"
    target="_blank"
  >http://ansible2.example.com</a>
return_content: yes
register: this
failed_when: &ldquo;’welcome’ not in this.content&rdquo;
- debug:
var: this.content
:::</p>
<p>The playbook in <a
  href="#ch11.xhtml#list11_7">Listing 11-7</a> uses the uri module
to connect to a web server. The <strong>return_content</strong> argument captures the
web server content, which is stored in a variable using <strong>register</strong>.
Next, the <strong>failed_when</strong> statement makes this module fail if the text
&ldquo;welcome&rdquo; is not in the registered variable. For debugging purposes, the
debug module is used to show the contents of the variable.</p>
<p>In <a
  href="#ch11.xhtml#list11_8">Listing 11-8</a> you can see the partial result
of running this playbook. Notice that the playbook does not generate a
failure because the default web page that is shown by the Apache web
server contains the text &ldquo;welcome.&rdquo;</p>
<p><strong>Listing 11-8 ansible-playbook listing117.yaml</strong> Command Result</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>ansible@control rhce8-book<span class="o">]</span>$ ansible-playbook listing117.yaml
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    PLAY <span class="o">[</span><span class="nb">test</span> webserver access<span class="o">]</span> ***************************************************
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> *********************************************************
</span></span><span class="line"><span class="cl">    ok: <span class="o">[</span>localhost<span class="o">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    TASK <span class="o">[</span>connect to the web server<span class="o">]</span> ***********************************************
</span></span><span class="line"><span class="cl">    ok: <span class="o">[</span>localhost<span class="o">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    TASK <span class="o">[</span>debug<span class="o">]</span> *******************************************************************
</span></span><span class="line"><span class="cl">    ok: <span class="o">[</span>localhost<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;this.content&#34;</span>: <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    PLAY RECAP *********************************************************************
</span></span></span><span class="line"><span class="cl"><span class="s2">    localhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span></code></pre></div><p>Using the uri module can be useful to perform a simple test to check
whether a web server is available, but you can also use it to check
accessibility or returned information from an API endpoint.</p>

<h4 class="relative group">Using the stat Module
    <div id="using-the-stat-module" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#using-the-stat-module" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>You can use the stat module to check on the status of files. Although
this module can be useful for checking on the status of just a few
files, it&rsquo;s not a file system integrity checker that was developed to
check file status on a large scale. If you need large-scale file system
integrity checking, you should use Linux utilities such as aide.</p>
<p>The stat module is useful in combination with <strong>register</strong>. In this use,
the stat module is used to register the status of a specific file, and
in a <strong>when</strong> statement, a check can be done to see whether the file
status is not as expected. In combination with the fail module, you can
use this module to generate a failure and error message if the file does
not meet the expected status. <a
  href="#ch11.xhtml#list11_9">Listing 11-9</a> shows
an example, and <a
  href="#ch11.xhtml#list11_10">Listing 11-10</a> shows the
resulting output, where you can see that the fail module fails the
playbook because the file owner is not root.</p>
<p><strong>Listing 11-9</strong> Using stat to Check Expected File Status</p>
<p>::: pre_1
&mdash;
- name: create a file
hosts: all
tasks:
- file:
path: /tmp/statfile
state: touch
owner: ansible</p>
<pre><code>- name: check file status
  hosts: all
  tasks:
  - stat:
      path: /tmp/statfile
    register: stat_out
  - fail:
      msg: &quot;/tmp/statfile file owner not as expected&quot;
    when: stat_out.stat.pw_name != ’root’
</code></pre>
<p>:::</p>
<p><strong>Listing 11-10 ansible-playbook listing119.yaml</strong> Command Result</p>
<p>::: pre_1
[ansible@control rhce8-book]$ ansible-playbook listing119.yaml</p>
<pre><code>PLAY [create a file] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [ansible2]
ok: [ansible1]
ok: [ansible3]
ok: [ansible4]
fatal: [ansible6]: UNREACHABLE! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;Failed to connect to the host via ssh: ansible@ansible6: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).&quot;, &quot;unreachable&quot;: true}
fatal: [ansible5]: UNREACHABLE! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;Failed to connect to the host via ssh: ssh: connect to host ansible5 port 22: No route to host&quot;, &quot;unreachable&quot;: true}

TASK [file] ********************************************************************
changed: [ansible2]
changed: [ansible1]
changed: [ansible3]
changed: [ansible4]

PLAY [check file status] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [ansible1]
ok: [ansible2]
ok: [ansible3]
ok: [ansible4]

TASK [stat] ********************************************************************
ok: [ansible2]
ok: [ansible1]
ok: [ansible3]
ok: [ansible4]

TASK [fail] ********************************************************************
fatal: [ansible2]: FAILED! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;/tmp/statfile file owner not as expected&quot;}
fatal: [ansible1]: FAILED! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;/tmp/statfile file owner not as expected&quot;}
fatal: [ansible3]: FAILED! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;/tmp/statfile file owner not as expected&quot;}
fatal: [ansible4]: FAILED! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;/tmp/statfile file owner not as expected&quot;}

PLAY RECAP *********************************************************************
ansible1                   : ok=4    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
ansible2                   : ok=4    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
ansible3                   : ok=4    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
ansible4                   : ok=4    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
ansible5                   : ok=0    changed=0    unreachable=1    failed=0    skipped=0    rescued=0    ignored=0
ansible6                   : ok=0    changed=0    unreachable=1    failed=0    skipped=0    rescued=0    ignored=0
</code></pre>
<p>:::</p>

<h4 class="relative group">Using the assert Module
    <div id="using-the-assert-module" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#using-the-assert-module" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>The assert module is a bit like the fail module. You can use it to
perform a specific conditional action. The assert module works with a
<strong>that</strong> option that defines a list of conditionals. If any one of these
conditionals is false, the task fails, and if all the conditionals are
true, the task is successful. Based on the success or failure of a task,
the module uses the <strong>success_msg</strong> or <strong>fail_msg</strong> options to print a
message. <a
  href="#ch11.xhtml#list11_11">Listing 11-11</a> shows an example that
uses the assert module.</p>
<p><strong>Listing 11-11</strong> Using the assert Module</p>
<p>::: pre_1
&mdash;
- hosts: localhost
vars_prompt:
- name: filesize
prompt: &ldquo;specify a file size in megabytes&rdquo;
tasks:
- name: check if file size is valid
assert:
that:
- &ldquo;{{ (filesize | int) &lt;= 100 }}&rdquo;
- &ldquo;{{ (filesize | int) &gt;= 1 }}&rdquo;
fail_msg: &ldquo;file size must be between 0 and 100&rdquo;
success_msg: &ldquo;file size is good, let\’s continue&rdquo;
- name: create a file
command: dd if=/dev/zero of=/bigfile bs=1 count={{ filesize }}
:::</p>
<p>The example in <a
  href="#ch11.xhtml#list11_11">Listing 11-11</a> contains a few new
items. As you can see, the play header starts with a <strong>vars_prompt</strong>.
This defines a variable named <strong>filesize</strong>, which is based on the input
provided by the user. This <strong>filesize</strong> variable is next used by the
assert module. The <strong>that</strong> statement contains a list in which two
conditions are stated. If specified like this, all conditions stated in
the <strong>that</strong> condition must be true. So you are looking for <strong>filesize</strong>
to be equal to or bigger than 1, and smaller than or equal to 100.</p>
<p>Before this can be done, one little problem needs to be managed: when
<strong>vars_prompt</strong> is used, the variable type is set to be a string by
default. This means that a statement like</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">**filesize left <span class="nv">caret</span><span class="o">=</span> 100**
</span></span></code></pre></div><p>would
fail with a type mismatch. That is why a Jinja2 filter is used to
convert the variable type from string to integer.</p>
<p>Filters are a powerful feature provided by the Jinja2 templating
language and can be used in Ansible to modify variables before
processing. For more information about filters, see
<a
  href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html"
    target="_blank"
  >https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html</a>.
The int filter can be used to convert the value of a string variable to
an integer. To do this, you need to rewrite the entire variable as a
Jinja2 operation, which is done using <strong>&quot;{{ (filesize | int) left caret= 100
}}&quot;</strong>.</p>
<p>In this line, the entire string is written as a variable. The variable
is further treated in a Jinja2 context. In this context, the part
<strong>(filesize | int)</strong> ensures that the string is converted to an
integer, which makes it possible to check if the value is smaller than
100.</p>
<p>When you run the code in <a
  href="#ch11.xhtml#list11_11">Listing 11-11</a>, the
result shown in <a
  href="#ch11.xhtml#list11_12">Listing 11-12</a> is produced.</p>
<p><strong>Listing 11-12 ansible-playbook listing1111.yaml</strong> Output</p>
<p>::: pre_1
[ansible@control rhce8-book]$ ansible-playbook listing1111.yaml</p>
<pre><code>PLAY [localhost] *****************************************************************

TASK [Gathering Facts] ***********************************************************
ok: [localhost]

TASK [check if file size is valid] ***********************************************
fatal: [localhost]: FAILED! =&gt; {
    &quot;assertion&quot;: &quot;filesize left caret= 100&quot;,
    &quot;changed&quot;: false,
    &quot;evaluated_to&quot;: false,
    &quot;msg&quot;: &quot;file size must be between 0 and 100&quot;
}

PLAY RECAP ***********************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
</code></pre>
<p>:::</p>
<p>As you can see, the task that is defined with the assert module fails
because the variable has a value that is not between the minimum and
maximum sizes that are defined.</p>
<p>Understanding the need for using the filter to convert the variable type
might not be easy. So, let&rsquo;s also look at <a
  href="#ch11.xhtml#list11_13">Listing
11-13</a>, which shows an example of a playbook that
will fail. You can see its behavior in <a
  href="#ch11.xhtml#list11_14">Listing
11-14</a>, where the playbook is executed.</p>
<p><strong>Listing 11-13</strong> Failing Version of the <a
  href="#ch11.xhtml#list11_11">Listing
11-11</a> Playbook</p>
<p>::: pre_1
&mdash;
- hosts: localhost
vars_prompt:
- name: filesize
prompt: &ldquo;specify a file size in megabytes&rdquo;
tasks:
- name: check if file size is valid
assert:
that:
- filesize &lt;= 100
- filesize &gt;= 1
fail_msg: &ldquo;file size must be between 0 and 100&rdquo;
success_msg: &ldquo;file size is good, let\’s continue&rdquo;
- name: create a file
command: dd if=/dev/zero of=/bigfile bs=1 count={{ filesize }}
:::</p>
<p><strong>Listing 11-14 ansible-playbook listing1113.yaml</strong> Failing Result</p>
<p>::: pre_1
[ansible@control rhce8-book]$ ansible-playbook listing1113.yaml
specify a file size in megabytes:</p>
<pre><code>PLAY [localhost] *****************************************************************

TASK [Gathering Facts] ***********************************************************
ok: [localhost]

TASK [check if file size is valid] ***********************************************
fatal: [localhost]: FAILED! =&gt; {&quot;msg&quot;: &quot;The conditional check ’filesize left caret= 100’ failed. The error was: Unexpected templating type error occurred on ({% if filesize left caret= 100 %} True {% else %} False {% endif %}): ’left caret=’ not supported between instances of ’str’ and ’int’&quot;}

PLAY RECAP ***********************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
</code></pre>
<p>:::</p>
<p>As you can see, the code in <a
  href="#ch11.xhtml#list11_13">Listing 11-13</a> fails
because the \left caret= test is not supported between a string and an integer.</p>
<p>In <a
  href="#ch11.xhtml#exe11_2">Exercise 11-2</a> you work with some of the
modules discussed in this section.</p>
<p>::: box
<strong>Exercise 11-2 Using Modules for Troubleshooting</strong></p>
<p>1. Open your editor to create the file exercise112.yaml and define the
play header:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: using assert to check if volume group vgdata exists
  hosts: all
  tasks:
</code></pre><p>2. Add a task that uses the command <strong>vgs vgdata</strong> to check whether a
volume group with the name vgdata exists. The task should use
<strong>register</strong> to register the command result, and it should continue if
this is not the case.</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: check if vgdata exists
  command: vgs vgdata
  register: vg_result
  ignore_errors: true
</code></pre><p>3. To make it easier to use <strong>assert</strong> in the next step on the right
variable, include a <strong>debug</strong> task to show the value of the variable:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: show vg_result variable
  debug:
    var: vg_result
</code></pre><p>4. Add a task to print a success or failure message, depending on the
result of the <strong>vgs</strong> command from the first task:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">- name: print a message
  assert:
    that:
    - vg_result.rc == 0
    fail_msg: volume group not found
    success_msg: volume group was found
</code></pre><p>5. Use the command <strong>ansible-playbook exercise112.yaml</strong> to verify its
contents. Assuming that the LVM Volume Group vgdata was not found, it
should print &ldquo;volume group not found.&rdquo;</p>
<p>6. Change the playbook to verify that it will print the <strong>success_msg</strong>
if the requested volume group was found. You can do so by having it run
the command <strong>vgs cl</strong>, which on CentOS 8 should give a positive result.
:::</p>

<h3 class="relative group">Troubleshooting Common Scenarios
    <div id="troubleshooting-common-scenarios" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#troubleshooting-common-scenarios" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Apart from the problems that may arise in playbooks, another type of
error relates to connectivity issues. To connect to managed hosts, SSH
must be configured correctly, and also authentication and privilege
escalation must work as expected.</p>

<h4 class="relative group">Analyzing Connectivity Issues
    <div id="analyzing-connectivity-issues" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#analyzing-connectivity-issues" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>To be able to connect to a managed host, you need to have an IP network
connection. Apart from that, you need to make sure that the host has
been set up correctly:</p>
<p>• The SSH service needs to be accessible on the remote host.</p>
<p>• Python must be installed.</p>
<p>• Privilege escalation needs to be set up.</p>
<p>Apart from these, inventory settings may be specified to indicate how to
connect to a remote host. Normally, the inventory contains a host name
only. If a host resolves to multiple IP addresses, you may want to
specify how exactly the remote host must be connected to. The
<strong>ansible_host</strong> parameter can be configured to do so. In inventory, for
instance, you may include the following line to ensure that your host is
connected in the right way:</p>
<pre><code>ansible5.example.com ansible_host=192.168.4.55
</code></pre>
<p>Notice that this setting makes sense only in an environment where a host
can be reached on multiple different IP addresses.</p>
<p>To test connectivity to remote hosts, you can use the ping module. It
checks for IP connectivity, accessibility of the SSH service, sudo
privilege escalation, and the availability of a Python stack. The ping
module does not take any arguments. <a
  href="#ch11.xhtml#list11_18">Listing
11-18</a> shows the result of running on the ad hoc
command <strong>ansible all -m ping</strong> where hosts that are available send
&ldquo;pong&rdquo; as a reply, and for hosts that are not available, you see why
they are not available.</p>
<p><strong>Listing 11-18</strong> Verifying Connectivity Using the ping Module</p>
<p>::: pre_1
[ansible@control rhce8-book]$ ansible all -m ping
ansible2 | SUCCESS =&gt; {
&ldquo;ansible_facts&rdquo;: {
&ldquo;discovered_interpreter_python&rdquo;: &ldquo;/usr/libexec/platform-python&rdquo;
},
&ldquo;changed&rdquo;: false,
&ldquo;ping&rdquo;: &ldquo;pong&rdquo;
}
ansible1 | SUCCESS =&gt; {
&ldquo;ansible_facts&rdquo;: {
&ldquo;discovered_interpreter_python&rdquo;: &ldquo;/usr/libexec/platform-python&rdquo;
},
&ldquo;changed&rdquo;: false,
&ldquo;ping&rdquo;: &ldquo;pong&rdquo;
}
ansible3 | SUCCESS =&gt; {
&ldquo;ansible_facts&rdquo;: {
&ldquo;discovered_interpreter_python&rdquo;: &ldquo;/usr/libexec/platform-python&rdquo;
},
&ldquo;changed&rdquo;: false,
&ldquo;ping&rdquo;: &ldquo;pong&rdquo;
}
ansible4 | FAILED! =&gt; {
&ldquo;msg&rdquo;: &ldquo;Missing sudo password&rdquo;
}
:::</p>

<h4 class="relative group">Analyzing Authentication Issues
    <div id="analyzing-authentication-issues" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#analyzing-authentication-issues" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>A few settings play a role in authentication on the remote host to
execute tasks:</p>
<p>• The <strong>remote_user</strong> setting determines which user account to use on
the managed nodes.</p>
<p>• SSH keys need to be configured for the remote_user to enable smooth
authentication.</p>
<p>• The <strong>become</strong> parameter needs to be set to true.</p>
<p>• The <strong>become_user</strong> needs to be set to the root user account.</p>
<p>• Linux sudo needs to be set up correctly.</p>
<p>In <a
  href="#ch11.xhtml#exe11_4">Exercise 11-4</a> you work on troubleshooting some
common scenarios.</p>
<p>::: box
<strong>Exercise 11-4 Troubleshooting Connectivity Issues</strong></p>
<p>1. Use an editor to create the file exercise114-1.yaml and give it the
following contents:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: remove user from wheel group
  hosts: ansible4
  tasks:
  - user:
      name: ansible
      groups: ’’
</code></pre><p>2. Run the playbook using <strong>ansible-playbook exercise114-1.yaml</strong> and
use <strong>ansible ansible4 -m reboot</strong> to reboot node ansible4.</p>
<p>3. Once the reboot is completed, use <strong>ansible all -m ping</strong> to verify
connectivity. Host ansible4 should give a &ldquo;Missing sudo password&rdquo; error.</p>
<p>4. Type <strong>ansible ansible4 -m raw -a &ldquo;usermod -aG wheel ansible&rdquo; -u
root -k</strong> to make user ansible a member of the group wheel again.</p>
<p>5. Repeat the <strong>ansible all -m ping</strong> command. You should now be able
to connect normally to the host ansible4 again.
:::</p>

<h1 class="relative group">Managing Ansible Errors and Logs
    <div id="managing-ansible-errors-and-logs" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#managing-ansible-errors-and-logs" aria-label="Anchor">#</a>
    </span>
    
</h1>

<h4 class="relative group">Using Check Mode
    <div id="using-check-mode" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#using-check-mode" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>Before actually running a playbook in a way that all changes are
implemented, you can start the playbooks in check mode. To do this, you
use the <strong>--check</strong> or <strong>-C</strong> command-line argument to the <strong>ansible</strong>
or <strong>ansible-playbook</strong> command. The effect of using check mode is that
changes that would have been made are shown but not executed. You should
realize, though, that check mode is not supported in all cases. You
will, for instance, have problems with check mode if it is applied to
conditionals, where a specific task can do its work only after a
preceding task has made some changes. Also, to successfully use check
mode, the modules need to support it, but some don&rsquo;t. Modules that don&rsquo;t
support check mode don&rsquo;t show any result while running check mode, but
also they don&rsquo;t make any changes.</p>
<p>Apart from the command-line argument, you can use <strong>check_mode: yes</strong> or
<strong>check_mode: no</strong> with any task in a playbook. If <strong>check_mode: yes</strong>
is used, the task always runs in check mode (and does not implement any
changes), regardless of the use of the <strong>--check</strong> option. If a task
has <strong>check_mode: no</strong> set, it never runs in check mode and just does
its work, even if the <strong>ansible-playbook</strong> command is used with the
<strong>--check</strong> option. Using check mode on individual tasks might be a
good idea if using check mode on the entire playbook gives unpredicted
results: you can enable it on just a couple of tasks to ensure that they
run successfully before proceeding to the next set of tasks. Notice that
using <strong>check_mode: no</strong> for specific tasks can be dangerous; these
tasks will make changes, even if the entire playbook was started with
the <strong>--check</strong> option!</p>
<p>::: note</p>
<hr>
<p><strong>Note</strong></p>
<p>The <strong>check_mode</strong> argument is a replacement for the <strong>always_run</strong>
option that was used in Ansible 2.5 and earlier. In current Ansible
versions, you should not use <strong>always_run</strong> anymore.</p>
<p>Another option that is commonly used with the <strong>--check</strong> option is
<strong>--diff</strong>. This option reports changes to template files without
actually applying them. <a
  href="#ch11.xhtml#list11_1">Listing 11-1</a> shows a
sample playbook, <a
  href="#ch11.xhtml#list11_2">Listing 11-2</a> shows the template
that it is processing, and <a
  href="#ch11.xhtml#list11_3">Listing 11-3</a> shows
the result of running this playbook with the <strong>ansible-playbook
listing111.yaml --check --diff</strong> command.</p>
<hr>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">    </span>---<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">simple template example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l">ansible2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">tasks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l">listing112.j2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/issue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">::</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">**Listing</span><span class="w"> </span><span class="m">11-2</span><span class="cp">**</span><span class="w"> </span><span class="l">Sample Template File</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">::</span><span class="p">:</span><span class="w"> </span><span class="l">pre_1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>{<span class="c"># /etc/issue #}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">Welcome to {{ ansible_facts[’hostname’] }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">::</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">**Listing</span><span class="w"> </span><span class="m">11-3</span><span class="cp">**</span><span class="w"> </span><span class="l">Running the listing111.yaml Sample Playbook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">::</span><span class="p">:</span><span class="w"> </span><span class="l">pre_1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">[</span><span class="l">ansible@control rhce8-book]$ ansible-playbook listing111.yaml --check --diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">PLAY [simple template example] *************************************************</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">TASK [Gathering Facts] *********************************************************</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">ansible2]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">TASK [template] ****************************************************************</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>--- <span class="l">before</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">+++ after</span><span class="p">:</span><span class="w"> </span><span class="l">/home/ansible/.ansible/tmp/ansible-local-4493uxbpju1e/tmpm5gn7crg/listing112.j2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>@@<span class="w"> </span>-<span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="w"> </span><span class="l">+1,3 @@</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">+Welcome to ansible2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">changed</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">ansible2]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">PLAY RECAP *********************************************************************</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ansible2                   </span><span class="p">:</span><span class="w"> </span><span class="l">ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><span class="w">
</span></span></span></code></pre></div>
<h4 class="relative group">Understanding Output
    <div id="understanding-output" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#understanding-output" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>When you run the <strong>ansible-playbook</strong> command, output is generated.
You&rsquo;ve probably had a glimpse of it before, but let&rsquo;s look at the output
in a more structured way now. <a
  href="#ch11.xhtml#list11_4">Listing 11-4</a> shows
some typical sample output generated by running the <strong>ansible-playbook</strong>
command.</p>
<p><strong>Listing 11-4 ansible-playbook</strong> Command Output</p>
<p>::: pre_1
[ansible@control rhce8-book]$ ansible-playbook listing52.yaml</p>
<pre><code>PLAY [install start and enable httpd] ******************************************

TASK [Gathering Facts] *********************************************************
ok: [ansible2]
ok: [ansible1]
ok: [ansible3]
ok: [ansible4]

TASK [install package] *********************************************************
changed: [ansible2]
changed: [ansible1]
changed: [ansible3]
changed: [ansible4]

TASK [start and enable service] ************************************************
changed: [ansible2]
changed: [ansible1]
changed: [ansible3]
changed: [ansible4]

PLAY RECAP *********************************************************************
ansible1                   : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
ansible2                   : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
ansible3                   : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
ansible4                   : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</code></pre>
<p>:::</p>
<p>In the output of any <strong>ansible-playbook</strong> command, you can see different
items:</p>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Image"
    src="/Images/key_topic_icon.jpg"
    ></figure>
{width=&ldquo;64&rdquo; height=&ldquo;51&rdquo;}</p>
<p>• An indicator of the play that is started</p>
<p>• If not disabled, the Gathering Facts task that is executed for each
play</p>
<p>• Each individual task, including the task name if that was specified</p>
<p>• The Play Recap, which summarizes the play results</p>
<p>In the Play Recap, different results can be shown. <a
  href="#ch11.xhtml#tab11_2">Table
11-2</a> gives an overview.</p>
<p>::: group
<strong>Table 11-2</strong> Playbook Recap Overview</p>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Image"
    src="../../../img/11tab02.jpg"
    ></figure>
{width=&ldquo;941&rdquo; height=&ldquo;338&rdquo;}
:::</p>
<p>As discussed before, when you use the <strong>ansible-playbook</strong> command, you
can increase the output verbosity level using one or more <strong>-v</strong>
options. <a
  href="#ch11.xhtml#tab11_3">Table 11-3</a> lists what these options
accomplish. For generic troubleshooting, you might want to consider
using <strong>-vv</strong>, which shows output as well as input data. In particular
cases using the <strong>-vvv</strong> option can be useful because it adds connection
information as well.</p>
<p>The <strong>-vvvv</strong> option just brings too much information in many cases but
can be useful if you need to analyze which exact scripts are executed or
whether any problems were encountered in privilege escalation. Make sure
to capture the output of any command that runs with <strong>-vvvv</strong> to a text
file, though, so that you can read it in an easy way. Even for a simple
playbook, it can easily generate more than 10 screens of output.</p>
<p>::: group
<strong>Table 11-3</strong> Verbosity Options Overview</p>
<p><figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="low"
    alt="Image"
    src="../../../img/11tab03.jpg"
    ></figure>
{width=&ldquo;941&rdquo; height=&ldquo;209&rdquo;}
:::</p>
<p>In <a
  href="#ch11.xhtml#list11_5">Listing 11-5</a> you can see the output of a
small playbook that runs different tasks on the managed hosts. <a
  href="#ch11.xhtml#list11_5">Listing
11-5</a> shows details about execution of one task on
host ansible4, and as you can see, it goes deep in the amount of detail
that is shown. One component is worth looking at, and that is the
escalation succeeded that you can see in the output. This means that
privilege escalation was successful and tasks were executed because
<strong>become_user</strong> was defined in ansible.cfg. Failing privilege escalation
is one of the common reasons why playbook execution may go wrong, which
is why it&rsquo;s worth keeping an eye on this indicator.</p>
<p><strong>Listing 11-5</strong> Analyzing Partial <strong>-vvvv</strong> Output</p>
<pre tabindex="0"><code>    &lt;ansible4&gt; ESTABLISH SSH CONNECTION FOR USER: ansible
    &lt;ansible4&gt; SSH: EXEC ssh -vvv -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o ’User=&#34;ansible&#34;’ -o ConnectTimeout=10 -o ControlPath=/home/ansible/.ansible/cp/859d5267e3 ansible4 ’/bin/sh -c ’&#34;’&#34;’chmod u+x /home/ansible/.ansible/tmp/ansible-tmp-1587544652.4716983-118789810824208/ /home/ansible/.ansible/tmp/ansible-tmp-1587544652.4716983-118789810824208/AnsiballZ_systemd.py &amp;&amp; sleep 0’&#34;’&#34;’’
    Escalation succeeded
    &lt;ansible4&gt; (0, b’’, b&#34;OpenSSH_8.0p1, OpenSSL 1.1.1c FIPS  28 May 2019\r\ndebug1: Reading configuration data /etc/ssh/ssh_config\r\ndebug3: /etc/ssh/ssh_config line 51: Including file /etc/ssh/ssh_config.d/05-redhat.conf depth 0\r\ndebug1: Reading configuration data /etc/ssh/ssh_config.d/05-redhat.conf\r\ndebug2: checking match for ’final all’ host ansible4 originally ansible4\r\ndebug3: /etc/ssh/ssh_config.d/05-redhat.conf line 3: not matched ’final’\r\ndebug2: match not found\r\ndebug3: /etc/ssh/ssh_config.d/05-redhat.conf line 5: Including file /etc/crypto-policies/back-ends/openssh.config depth 1 (parse only)\r\ndebug1: Reading configuration data /etc/crypto-policies/back-ends/openssh.config\r\ndebug3: gss kex names ok: [gss-gex-sha1-,gss-group14-sha1-]\r\ndebug3: kex names ok: [curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group14-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1]\r\ndebug1: configuration requests final Match pass\r\ndebug1: re-parsing configuration\r\ndebug1: Reading configuration data /etc/ssh/ssh_config\r\ndebug3: /etc/ssh/ssh_config line 51: Including file /etc/ssh/ssh_config.d/05-redhat.conf depth 0\r\ndebug1: Reading configuration data /etc/ssh/ssh_config.d/05-redhat.conf\r\ndebug2: checking match for ’final all’ host ansible4 originally ansible4\r\ndebug3: /etc/ssh/ssh_config.d/05-redhat.conf line 3: matched ’final’\r\ndebug2: match found\r\ndebug3: /etc/ssh/ssh_config.d/05-redhat.conf line 5: Including file /etc/crypto-policies/back-ends/openssh.config depth 1\r\ndebug1: Reading configuration data /etc/crypto-policies/back-ends/openssh.config\r\ndebug3: gss kex names ok: [gss-gex-sha1-,gss-group14-sha1-]\r\ndebug3: kex names ok: [curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group14-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1]\r\ndebug1: auto-mux: Trying existing master\r\ndebug2: fd 4 setting O_NONBLOCK\r\ndebug2: mux_client_hello_exchange: master version 4\r\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\r\ndebug3: mux_client_request_session: entering\r\ndebug3: mux_client_request_alive: entering\r\ndebug3: mux_client_request_alive: done pid = 4764\r\ndebug3: mux_client_request_session: session request sent\r\ndebug3: mux_client_read_packet: read header failed: Broken pipe\r\ndebug2: Received exit status from master 0\r\n&#34;)
    &lt;ansible4&gt; ESTABLISH SSH CONNECTION FOR USER: ansible
    &lt;ansible4&gt; SSH: EXEC ssh -vvv -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o ’User=&#34;ansible&#34;’ -o ConnectTimeout=10 -o ControlPath=/home/ansible/.ansible/cp/859d5267e3 -tt ansible4 ’/bin/sh -c ’&#34;’&#34;’sudo -H -S -n  -u root /bin/sh -c ’&#34;’&#34;’&#34;’&#34;’&#34;’&#34;’&#34;’&#34;’echo BECOME-SUCCESS-muvtpdvqkslnlegyhoibfcrilvlyjcqp ; /usr/libexec/platform-python /home/ansible/.ansible/tmp/ansible-tmp-1587544652.4716983-118789810824208/AnsiballZ_systemd.py’&#34;’&#34;’&#34;’&#34;’&#34;’&#34;’&#34;’&#34;’ &amp;&amp; sleep 0’&#34;’&#34;’’
    Escalation succeeded
</code></pre>
<h4 class="relative group">Optimizing Command Output Error Formatting
    <div id="optimizing-command-output-error-formatting" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#optimizing-command-output-error-formatting" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>You might have noticed that the formatting of error messages in Ansible
command output can be a bit hard to read. Fortunately, there&rsquo;s an easy
way to make it a little more readable by including two options in the
ansible.cfg file. These options are <strong>stdout_callback = debug</strong> and
<strong>stdout_callback = error</strong>. After including these options, you&rsquo;ll
notice it&rsquo;s a lot easier to read error output and distinguish between
its different components!</p>

<h4 class="relative group">Logging to Files
    <div id="logging-to-files" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#logging-to-files" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>By default, Ansible does not write anything to log files. The reason is
that the Ansible commands have all the options that may be useful to
write output to the STDOUT. If so required, it&rsquo;s always possible to use
shell redirection to write the command output to a file.</p>
<p>If you do need Ansible to write log files, you can set the <strong>log_path</strong>
parameter in ansible.cfg. Alternatively, Ansible can log to the filename
that is specified as the argument to the $ANSIBLE_LOG_PATH variable.
Notice that Ansible logs can grow big very fast, so if logging to output
files is enabled, make sure that Linux log rotation is configured to
ensure that files cannot grow beyond a specific maximum size.</p>

<h4 class="relative group">Running Task by Task
    <div id="running-task-by-task" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#running-task-by-task" aria-label="Anchor">#</a>
    </span>
    
</h4>
<p>When you analyze playbook behavior, it&rsquo;s possible to run playbook tasks
one by one or to start running a playbook at a specific task. The
<strong>ansible-playbook --step</strong> command runs playbooks task by task and
prompts for confirmation before running the next task. Alternatively,
you can use the <strong>ansible-playbook --start-at-task=&quot;task name&quot;</strong>
command to start playbook execution as a specific task. Before using
this command, you might want to use <strong>ansible-playbook --list-tasks</strong>
for a list of all tasks that have been configured. To use these options
in an efficient way, you must configure each task with its own name. In
<a
  href="#ch11.xhtml#list11_6">Listing 11-6</a> you can see what running playbooks
this way looks like. This listing first shows how to list tasks in a
playbook and next how the <strong>--start-at-task</strong> and <strong>--step</strong> options
are used.</p>
<p><strong>Listing 11-6</strong> Running Tasks One by One</p>
<p>::: pre_1
[ansible@control rhce8-book]$ ansible-playbook &ndash;list-tasks exercise81.yaml</p>
<pre><code>playbook: exercise81.yaml

  play #1 (ansible1): testing file manipulation skills.    TAGS: []
    tasks:
      create a new file              TAGS: []
      check status of the new file   TAGS: []
      for debugging purposes only    TAGS: []
      change file owner if needed    TAGS: []

  play #2 (ansible1): fetching a remote file.    TAGS: []
    tasks:
      fetch file from remote machine.    TAGS: []

  play #3 (localhost): adding text to the file that is now on localhost TAGS: []
    tasks:
      add a message.    TAGS: []

  play #4 (ansible2): copy the modified file to ansible2.    TAGS: []
    tasks:
      copy motd file.    TAGS: []
[ansible@control rhce8-book]$ ansible-playbook --start-at-task &quot;add a message&quot;  --step exercise81.yaml

PLAY [testing file manipulation skills] ****************************************

PLAY [fetching a remote file] **************************************************

PLAY [adding text to the file that is now on localhost] ************************
Perform task: TASK: Gathering Facts (N)o/(y)es/(c)ontinue:
</code></pre>
<p>:::</p>
<p>In <a
  href="#ch11.xhtml#exe11_1">Exercise 11-1</a> you learn how to apply check
mode while working with templates.</p>
<p>::: box
<strong>Exercise 11-1 Using Templates in Check Mode</strong></p>
<p>1. Locate the file httpd.conf; you can find it in the rhce8-book
directory, which you can download from the GitHub repository at
<a
  href="https://github.com/sandervanvugt/rhce8-book"
    target="_blank"
  >https://github.com/sandervanvugt/rhce8-book</a>. Use <strong>mv httpd.conf
exercise111-httpd.j2</strong> to rename it to a Jinja2 template file.</p>
<p>2. Open the exercise111-httpd.j2 file with an editor, and apply
modifications to existing parameters so that they look like the
following:</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">ServerRoot &#34;{{ apache_root }}&#34;
User {{ apache_user }}
Group {{ apache_group }}
</code></pre><p>3. Write a playbook that takes care of the complete Apache web server
setup and installation, starts and enables the service, opens a port in
the firewall, and uses the template module to create the
/etc/httpd/conf/httpd.conf file based on the template that you created
in step 2 of this exercise. The complete playbook with the name
exercise111.yaml looks like the following (make sure you have the
<em>exact</em> contents shown below and do <em>not</em> correct any typos):</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: perform basic apache setup
  hosts: ansible2
  vars:
    apache_root: /etc/httpd
    apache_user: httpd
    apache_group: httpd
  tasks:
  - name: install RPM package
    yum:
      name: httpd
      state: latest
  - name: copy template file
    template:
      src: exercise111-httpd.j2
      dest: /etc/httpd/httpd.conf
  - name: start and enable service
    service:
      name: httpd
      state: started
      enabled: yes
  - name: open port in firewall
    firewalld:
      service: http
      permanent: yes
      state: enabled
      immediate: yes
</code></pre><p>4. Run the command <strong>ansible-playbook --syntax-check
exercise111.yaml</strong>. If no errors are found in the playbook syntax, you
should just see the name of the playbook.</p>
<p>5. Run the command <strong>ansible-playbook --check --diff
exercise111.yaml</strong>. In the output of the command, pay attention to the
task copy template file. After the line that starts with <strong>+++ after</strong>,
you should see the lines in the template that were configured to use a
variable, using the right variables.</p>
<p>6. Run the playbook to perform all its tasks step by step, using the
command <strong>ansible-playbook --step exercise111.yaml</strong>. Press <strong>y</strong> to
confirm the first step. Next, press <strong>c</strong> to automatically continue. The
playbook will fail on the copy template file task because the target
directory does not exist. Notice that the <strong>--syntax-check</strong> and the
<strong>--check</strong> options do not check for any logical errors in the playbook
and for that reason have not detected this problem.</p>
<p>7. Edit the exercise111.yaml file and ensure the <strong>template</strong> task
contains the following corrected line: (replace the old line starting
with <strong>dest:</strong>):</p>
<pre tabindex="0"><code class="language-pre1" data-lang="pre1">dest: /etc/httpd/conf/httpd.conf
</code></pre><p>8. Type <strong>ansible-playbook --list-tasks exercise111.yaml</strong> to list all
the tasks in the playbook.</p>
<p>9. To avoid running the entire playbook again, use <strong>ansible-playbook
--start-at-task=&quot;copy template file&quot; exercise111.yaml</strong> to run the
playbook to completion.
:::</p>

          
          
          
        </div>
        
        

        

        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js"
          integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="
          data-oid="views_tech/ansible/Troubleshooting in Ansible.md"
          data-oid-likes="likes_tech/ansible/Troubleshooting in Ansible.md"></script>
      
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      

      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
      
      
        
      
      
      
      
      <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 overflow-x-auto py-2">
        <ul class="flex list-none flex-row">
          
            <li class=" flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 me-4">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href=""
                title="">
                
                
              </a>
            </li>
          
        </ul>
      </nav>
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2025
          David Thomas
      </p>
    

    
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="http://localhost:1313/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
